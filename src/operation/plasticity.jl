
"""
1D Plasticity
"""
function (op::Operator{:âˆ«vâ‚“Ïƒdx})(ap::T,k::AbstractMatrix{Float64},fint::AbstractVector) where T<:AbstractElement
    ğ“’ = ap.ğ“’; ğ“– = ap.ğ“–
    E = op.E
    K = op.K
    Ïƒy = op.Ïƒy
    tol = op.tol 
    for Î¾ in ğ“–
        B = Î¾[:âˆ‚ğ­âˆ‚x]
        Ïƒâ‚™ = Î¾.Ïƒâ‚™
        Î±â‚™ = Î¾.Î±â‚™
        Îµáµ–â‚™ = Î¾.Îµáµ–â‚™
        ğ‘¤ = Î¾.ğ‘¤
        Î”Îµâ‚™ = 0.0
        for (i,xáµ¢) in enumerate(ğ“’)
            Î”Îµâ‚™ += B[i]*xáµ¢.Î”d
        end
        # predict phase
        Ïƒáµ—Ê³ = Ïƒâ‚™+E*Î”Îµâ‚™
        fáµ—Ê³ = abs(Ïƒáµ—Ê³) - (Ïƒy+K*Î±â‚™)
        if fáµ—Ê³ > tol
            Î”Î³ = fáµ—Ê³/(E+K)
            Î¾.Ïƒâ‚™ = Ïƒáµ—Ê³ - Î”Î³*E*sign(Ïƒáµ—Ê³)
            Î¾.Îµáµ–â‚™ = Îµáµ–â‚™ + Î”Î³*sign(Ïƒáµ—Ê³)
            Î¾.Î±â‚™ = Î±â‚™ + Î”Î³
            Eâ‚œ = (E*K)/(E+K)
        else
            Î¾.Ïƒâ‚™ = Ïƒáµ—Ê³
            Eâ‚œ = E
        end
        for (i,xáµ¢) in enumerate(ğ“’)
            I = xáµ¢.ğ¼
            for (j,xâ±¼) in enumerate(ğ“’)
                J = xâ±¼.ğ¼
                k[I,J] += B[i]*Eâ‚œ*B[j]*ğ‘¤
            end
            fint[I] += B[i]*Î¾.Ïƒâ‚™*ğ‘¤
        end
    end
end

"""
morh-coulbom
"""
function (op::Operator{:âˆ«váµ¢ÏƒdÎ©_mohr_coulomb})(ap::T;k::AbstractMatrix{Float64},fint::AbstractVector{Float64}) where T<:AbstractElement
    ğ“’ = ap.ğ“’; ğ“– = ap.ğ“–
    Î» = op.Î»
    Î¼ = op.Î¼
    c = op.c
    ğœ™ = op.ğœ™
    tol = op.tol 
    Cáµ¢áµ¢áµ¢áµ¢ = Î» + 2.0*Î¼
    Cáµ¢áµ¢â±¼â±¼ = Î»
    Câ‚â‚‚â‚â‚‚ =  Î¼
    Câ‚â‚‚â‚â‚‚ =  Î¼
    Câ‚â‚â‚â‚ = Cáµ¢áµ¢áµ¢áµ¢
    Câ‚‚â‚‚â‚‚â‚‚ = Cáµ¢áµ¢áµ¢áµ¢
    Câ‚ƒâ‚ƒâ‚ƒâ‚ƒ = Cáµ¢áµ¢áµ¢áµ¢
    Câ‚â‚â‚‚â‚‚ = Cáµ¢áµ¢â±¼â±¼
    Câ‚â‚â‚ƒâ‚ƒ = Cáµ¢áµ¢â±¼â±¼
    Câ‚‚â‚‚â‚ƒâ‚ƒ = Cáµ¢áµ¢â±¼â±¼
    
    for Î¾ in ğ“–
        Bâ‚ = Î¾[:âˆ‚ğ­âˆ‚x]
        Bâ‚‚ = Î¾[:âˆ‚ğ­âˆ‚y]
        Ïƒâ‚â‚ = Î¾.Ïƒâ‚â‚
        Ïƒâ‚‚â‚‚ = Î¾.Ïƒâ‚‚â‚‚
        Ïƒâ‚ƒâ‚ƒ = Î¾.Ïƒâ‚ƒâ‚ƒ
        Ïƒâ‚â‚‚ = Î¾.Ïƒâ‚â‚‚
        Îµáµ–â‚â‚ = Î¾.Îµáµ–â‚â‚
        Îµáµ–â‚‚â‚‚ = Î¾.Îµáµ–â‚‚â‚‚
        Îµáµ–â‚â‚‚ = Î¾.Îµáµ–â‚â‚‚
        ğ‘¤ = Î¾.ğ‘¤
        Î”Îµâ‚â‚ = 0.0
        Î”Îµâ‚‚â‚‚ = 0.0
        Î”Îµâ‚â‚‚ = 0.0
        for (i,xáµ¢) in enumerate(ğ“’)
            Î”Îµâ‚â‚ += Bâ‚[i]*xáµ¢.Î”dâ‚
            Î”Îµâ‚‚â‚‚ += Bâ‚‚[i]*xáµ¢.Î”dâ‚‚
            Î”Îµâ‚â‚‚ += Bâ‚[i]*xáµ¢.Î”dâ‚‚ + Bâ‚‚[i]*xáµ¢.Î”dâ‚
        end 
        # predict phase
        Ïƒâ‚â‚áµ—Ê³ =Ïƒâ‚â‚+Câ‚â‚â‚â‚*Î”Îµâ‚â‚+Câ‚â‚â‚‚â‚‚*Î”Îµâ‚‚â‚‚
        Ïƒâ‚‚â‚‚áµ—Ê³ =Ïƒâ‚‚â‚‚+Câ‚‚â‚‚â‚‚â‚‚*Î”Îµâ‚‚â‚‚+Câ‚â‚â‚‚â‚‚*Î”Îµâ‚â‚
        Ïƒâ‚â‚‚áµ—Ê³ =Ïƒâ‚â‚‚+Câ‚â‚‚â‚â‚‚*Î”Îµâ‚â‚‚
        Ïƒâ‚ƒâ‚ƒáµ—Ê³ =Ïƒâ‚ƒâ‚ƒ
        Ïƒâ‚,Ïƒâ‚‚,Ïƒâ‚ƒ,nâ‚,nâ‚‚,nâ‚ƒ = getÏƒâ‚™(Ïƒâ‚â‚áµ—Ê³,Ïƒâ‚‚â‚‚áµ—Ê³,Ïƒâ‚ƒâ‚ƒáµ—Ê³,Ïƒâ‚â‚‚áµ—Ê³,0.0,0.0)
        fáµ—Ê³ = Ïƒâ‚-Ïƒâ‚ƒ + (Ïƒâ‚+Ïƒâ‚ƒ) * sin(ğœ™) - 2.0*c*cos(ğœ™)
        if fáµ—Ê³ > tol
            sinğœ™ = sin(ğœ™)
            sinÂ²ğœ™ = sin(ğœ™)*sin(ğœ™)
            sinÂ²ğœ™psinğœ™ = sinÂ²ğœ™ +sin(ğœ™) 
            sinÂ²ğœ™dsinğœ™ = sinÂ²ğœ™ -sin(ğœ™) 
            âˆ‚fCâˆ‚f=(4.0*sinÂ²ğœ™*Î»+4.0*(1.0+sinÂ²ğœ™)*Î¼)
            Î”Î³ = fáµ—Ê³/âˆ‚fCâˆ‚f
           
            Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³ - Î”Î³*2.0*((2*sinğœ™*Î»+2*((sinğœ™+1)*nâ‚[1]*nâ‚[1]+(sinğœ™-1)*nâ‚ƒ[1]*nâ‚ƒ[1])*Î¼))#ä¸Šæ ‡1å¯¹åº”ä¹‹å‰ä¸‹æ ‡1
            Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³ - Î”Î³*2.0*((2*sinğœ™*Î»+2*((sinğœ™+1)*nâ‚[2]*nâ‚[2]+(sinğœ™-1)*nâ‚ƒ[2]*nâ‚ƒ[2])*Î¼))
            Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³ - Î”Î³*(2*((sinğœ™+1)*nâ‚[1]*nâ‚[2]+(sinğœ™-1)*nâ‚ƒ[1]*nâ‚ƒ[2])*Î¼)
            Î¾.Îµáµ–â‚â‚ = Îµáµ–â‚â‚ + Î”Î³*((sinğœ™+1)*nâ‚[1]*nâ‚[1]+(sinğœ™-1)nâ‚ƒ[1]*nâ‚ƒ[1])
            Î¾.Îµáµ–â‚‚â‚‚ = Îµáµ–â‚‚â‚‚ + Î”Î³*((sinğœ™+1)*nâ‚[2]*nâ‚[2]+(sinğœ™-1)nâ‚ƒ[2]*nâ‚ƒ[2])
            Î¾.Îµáµ–â‚â‚‚ = Îµáµ–â‚â‚‚ + Î”Î³*(((sinğœ™+1)*nâ‚[1]*nâ‚[2]+(sinğœ™-1)nâ‚ƒ[1]*nâ‚ƒ[2]))

            Cáµ—â‚â‚â‚â‚=Câ‚â‚â‚â‚-(4.0*sinÂ²ğœ™*Î»^2 + 8.0*sinÂ²ğœ™psinğœ™*Î»*Î¼*(nâ‚[1])^2 + 8.0*(sinÂ²ğœ™dsinğœ™)*Î»*Î¼*(nâ‚ƒ[1])^2-8.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚[1]^2*nâ‚ƒ[1]^2+4.0*(sinğœ™+1)^2*Î¼^2*(nâ‚[1])^4+4.0*(sinğœ™-1)^2*Î¼^2*(nâ‚ƒ[1])^4)/âˆ‚fCâˆ‚f
            Cáµ—â‚‚â‚‚â‚‚â‚‚=Câ‚‚â‚‚â‚‚â‚‚-(4.0*sinÂ²ğœ™*Î»^2 + 8.0*sinÂ²ğœ™psinğœ™*Î»*Î¼*(nâ‚[2])^2 + 8.0*(sinÂ²ğœ™dsinğœ™)*Î»*Î¼*(nâ‚ƒ[2])^2-8.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚[2]^2*nâ‚ƒ[2]^2+4.0*(sinğœ™+1)^2*Î¼^2*(nâ‚[2])^4+4.0*(sinğœ™-1)^2*Î¼^2*(nâ‚ƒ[2])^4)/âˆ‚fCâˆ‚f
            Cáµ—â‚â‚â‚‚â‚‚=Câ‚â‚â‚‚â‚‚-(4.0*sinÂ²ğœ™*Î»^2 + 4.0*sinÂ²ğœ™psinğœ™*Î»*Î¼*((nâ‚[1])^2+(nâ‚[2])^2)+4.0*(sinÂ²ğœ™dsinğœ™)*Î»*Î¼*((nâ‚ƒ[1])^2+(nâ‚ƒ[2])^2)+4.0*(sinğœ™+1)^2*Î¼^2*(nâ‚[1])^2*(nâ‚[2])^2-4.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*((nâ‚ƒ[1])^2*(nâ‚[2])^2+(nâ‚[1])^2*(nâ‚ƒ[2])^2)+4.0*(sinğœ™-1)^2*Î¼^2*(nâ‚ƒ[1])^2*(nâ‚ƒ[2])^2)/âˆ‚fCâˆ‚f
            Cáµ—â‚â‚‚â‚â‚‚=Câ‚â‚‚â‚â‚‚-(-8.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚[1]*nâ‚[2]*nâ‚ƒ[1]*nâ‚ƒ[2]+4.0*(sinğœ™+1)^2*Î¼^2*(nâ‚[1]*nâ‚[2])^2+4.0*(sinğœ™-1)^2*Î¼^2*(nâ‚ƒ[1]*nâ‚ƒ[2])^2)/âˆ‚fCâˆ‚f
        else
            Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³
            Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³
            Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³
            Cáµ—â‚â‚â‚â‚ = Câ‚â‚â‚â‚
            Cáµ—â‚‚â‚‚â‚‚â‚‚ = Câ‚‚â‚‚â‚‚â‚‚
            Cáµ—â‚â‚â‚‚â‚‚ = Câ‚â‚â‚‚â‚‚
            Cáµ—â‚â‚‚â‚â‚‚ = Câ‚â‚‚â‚â‚‚
          
        end
       # if isnan(Ïƒâ‚â‚)
       #    
       #       Ïƒâ‚â‚ = NaN
       #       error("ç¨‹åºç»ˆæ­¢ï¼šÏƒâ‚â‚çš„å€¼ä¸ºNaN")
       # end
       
        for (i,xáµ¢) in enumerate(ğ“’)
            I = xáµ¢.ğ¼
            for (j,xâ±¼) in enumerate(ğ“’)
                J = xâ±¼.ğ¼
                k[2*I-1,2*J-1] += (Cáµ—â‚â‚â‚â‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j])*ğ‘¤
                k[2*I-1,2*J]   += (Cáµ—â‚â‚â‚‚â‚‚*Bâ‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚[j])*ğ‘¤
                k[2*I,2*J-1]   += (Cáµ—â‚â‚â‚‚â‚‚*Bâ‚‚[i]*Bâ‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚[i]*Bâ‚‚[j])*ğ‘¤
                k[2*I,2*J]     += (Cáµ—â‚‚â‚‚â‚‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚[i]*Bâ‚[j])*ğ‘¤
     
            end
            fint[2*I-1] += Bâ‚[i]*Î¾.Ïƒâ‚â‚*ğ‘¤ + Bâ‚‚[i]*Î¾.Ïƒâ‚â‚‚*ğ‘¤
            fint[2*I]   += Bâ‚[i]*Î¾.Ïƒâ‚â‚‚*ğ‘¤ + Bâ‚‚[i]*Î¾.Ïƒâ‚‚â‚‚*ğ‘¤
    
        end
    end
end    
