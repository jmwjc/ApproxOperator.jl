"""
1D Plasticity
"""
function (op::Operator{:âˆ«vâ‚“Ïƒdx})(ap::T,k::AbstractMatrix{Float64},fint::AbstractVector) where T<:AbstractElement
    ğ“’ = ap.ğ“’; ğ“– = ap.ğ“–
    E = op.E
    K = op.K
    Ïƒy = op.Ïƒy
    for Î¾ in ğ“–
        B = Î¾[:âˆ‚ğ­âˆ‚x]
        Ïƒâ‚™ = Î¾.Ïƒâ‚™
        Î±â‚™ = Î¾.Î±â‚™
        Îµáµ–â‚™ = Î¾.Îµáµ–â‚™
        ğ‘¤ = Î¾.ğ‘¤
        Î”Îµâ‚™ = 0.0
        for (i,xáµ¢) in enumerate(ğ“’)
            Î”Îµâ‚™ += B[i]*xáµ¢.Î”d
        end
        # predict phase
        Ïƒáµ—Ê³ = Ïƒâ‚™+E*Î”Îµâ‚™
        fáµ—Ê³ = abs(Ïƒáµ—Ê³) - (Ïƒy+K*Î±â‚™)
        if fáµ—Ê³ > 1E-13
            Î”Î³ = fáµ—Ê³/(E+K)
            Î¾.Ïƒâ‚™ = Ïƒáµ—Ê³ - Î”Î³*E*sign(Ïƒáµ—Ê³)
            Î¾.Îµáµ–â‚™ = Îµáµ–â‚™ + Î”Î³*sign(Ïƒáµ—Ê³)
            Î¾.Î±â‚™ = Î±â‚™ + Î”Î³
            Eâ‚œ = (E*K)/(E+K)
        else
            Î¾.Ïƒâ‚™ = Ïƒáµ—Ê³
            Eâ‚œ = E
        end
        for (i,xáµ¢) in enumerate(ğ“’)
            I = xáµ¢.ğ¼
            for (j,xâ±¼) in enumerate(ğ“’)
                J = xâ±¼.ğ¼
                k[I,J] += B[i]*Eâ‚œ*B[j]*ğ‘¤
            end
            fint[I] += B[i]*Î¾.Ïƒâ‚™*ğ‘¤
        end
    end
end

"""
Tresca
"""
function (op::Operator{:âˆ«váµ¢ÏƒdÎ©_tresca})(ap::T;k::AbstractMatrix{Float64},fint::AbstractVector{Float64}) where T<:AbstractElement
    ğ“’ = ap.ğ“’; ğ“– = ap.ğ“–
    Î» = op.Î»
    Î¼ = op.Î¼
    c = op.c
    Cáµ¢áµ¢áµ¢áµ¢ = Î» + 2.0*Î¼
    Cáµ¢áµ¢â±¼â±¼ = Î»
    Cáµ¢â±¼áµ¢â±¼ = Î¼
    
    for Î¾ in ğ“–
        Bâ‚ = Î¾[:âˆ‚ğ­âˆ‚x]
        Bâ‚‚ = Î¾[:âˆ‚ğ­âˆ‚y]
        Ïƒâ‚â‚ = Î¾.Ïƒâ‚â‚
        Ïƒâ‚‚â‚‚ = Î¾.Ïƒâ‚‚â‚‚
        Ïƒâ‚â‚‚ = Î¾.Ïƒâ‚â‚‚
        Îµáµ–â‚â‚ = Î¾.Îµáµ–â‚â‚
        Îµáµ–â‚‚â‚‚ = Î¾.Îµáµ–â‚‚â‚‚
        Îµáµ–â‚â‚‚ = Î¾.Îµáµ–â‚â‚‚
        ğ‘¤ = Î¾.ğ‘¤
        Î”Îµâ‚â‚ = 0.0
        Î”Îµâ‚‚â‚‚ = 0.0
        Î”Îµâ‚â‚‚ = 0.0
        for (i,xáµ¢) in enumerate(ğ“’)
            Î”Îµâ‚â‚ += Bâ‚[i]*xáµ¢.Î”dâ‚
            Î”Îµâ‚‚â‚‚ += Bâ‚‚[i]*xáµ¢.Î”dâ‚‚
            Î”Îµâ‚â‚‚ += Bâ‚[i]*xáµ¢.Î”dâ‚‚ + Bâ‚‚[i]*xáµ¢.Î”dâ‚
        end 

        # predict phase
        Ïƒâ‚â‚áµ—Ê³ = Ïƒâ‚â‚ + Cáµ¢áµ¢áµ¢áµ¢*Î”Îµâ‚â‚+Cáµ¢áµ¢â±¼â±¼*Î”Îµâ‚‚â‚‚
        Ïƒâ‚‚â‚‚áµ—Ê³ = Ïƒâ‚‚â‚‚ + Cáµ¢áµ¢áµ¢áµ¢*Î”Îµâ‚‚â‚‚+Cáµ¢áµ¢â±¼â±¼*Î”Îµâ‚â‚
        Ïƒâ‚â‚‚áµ—Ê³ = Ïƒâ‚â‚‚ + Cáµ¢â±¼áµ¢â±¼*Î”Îµâ‚â‚‚
        Ïƒâ‚,Ïƒâ‚‚,nâ‚,nâ‚‚ = getÏƒâ‚™(Ïƒâ‚â‚áµ—Ê³,Ïƒâ‚‚â‚‚áµ—Ê³,Ïƒâ‚â‚‚áµ—Ê³)
        fáµ—Ê³ = Ïƒâ‚ - Ïƒâ‚‚ - 2.0*c

        if fáµ—Ê³ > 1E-13
            Î”Î³ = fáµ—Ê³/4.0/Î¼
           
            Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³ - Î”Î³*2.0*Î¼*(nâ‚[1]*nâ‚[1] - nâ‚‚[1]*nâ‚‚[1])
            Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³ - Î”Î³*2.0*Î¼*(nâ‚[2]*nâ‚[2] - nâ‚‚[2]*nâ‚‚[2])
            Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³ - Î”Î³*2.0*Î¼*(nâ‚[1]*nâ‚[2] - nâ‚‚[1]*nâ‚‚[2])
            Î¾.Îµáµ–â‚â‚ = Îµáµ–â‚â‚ + Î”Î³*(nâ‚[1]*nâ‚[1] - nâ‚‚[1]*nâ‚‚[1])
            Î¾.Îµáµ–â‚‚â‚‚ = Îµáµ–â‚‚â‚‚ + Î”Î³*(nâ‚[2]*nâ‚[2] - nâ‚‚[2]*nâ‚‚[2])
            Î¾.Îµáµ–â‚â‚‚ = Îµáµ–â‚â‚‚ + Î”Î³*(nâ‚[1]*nâ‚[2] - nâ‚‚[1]*nâ‚‚[2])

            Cáµ—â‚â‚â‚â‚ = Cáµ¢áµ¢áµ¢áµ¢ - Î¼*(nâ‚[1]*nâ‚[1] - nâ‚‚[1]*nâ‚‚[1])^2
            Cáµ—â‚‚â‚‚â‚‚â‚‚ = Cáµ¢áµ¢áµ¢áµ¢ - Î¼*(nâ‚[2]*nâ‚[2] - nâ‚‚[2]*nâ‚‚[2])^2
            Cáµ—â‚â‚â‚‚â‚‚ = Cáµ¢áµ¢â±¼â±¼ - Î¼*(nâ‚[1]*nâ‚[1] - nâ‚‚[1]*nâ‚‚[1])*(nâ‚[2]*nâ‚[2] - nâ‚‚[2]*nâ‚‚[2])
            Cáµ—â‚â‚‚â‚â‚‚ = Cáµ¢â±¼áµ¢â±¼ - 2.0*Î¼*(nâ‚[1]*nâ‚[2] - nâ‚‚[1]*nâ‚‚[2])^2
            Cáµ—â‚â‚â‚â‚‚ = - Î¼*(nâ‚[1]*nâ‚[1] - nâ‚‚[1]*nâ‚‚[1])*(nâ‚[1]*nâ‚[2] - nâ‚‚[1]*nâ‚‚[2])
            Cáµ—â‚‚â‚‚â‚â‚‚ = - Î¼*(nâ‚[2]*nâ‚[2] - nâ‚‚[2]*nâ‚‚[2])*(nâ‚[1]*nâ‚[2] - nâ‚‚[1]*nâ‚‚[2])
             #println(Cáµ—â‚â‚â‚â‚)
             #println(Cáµ—â‚‚â‚‚â‚‚â‚‚)
             #println(Cáµ—â‚â‚â‚‚â‚‚)
             #println(Cáµ—â‚â‚‚â‚â‚‚)
             #println(Cáµ—â‚â‚â‚â‚‚)
             #println(Cáµ—â‚‚â‚‚â‚â‚‚)
        else
            Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³
            Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³
            Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³
            Cáµ—â‚â‚â‚â‚ = Cáµ¢áµ¢áµ¢áµ¢
            Cáµ—â‚‚â‚‚â‚‚â‚‚ = Cáµ¢áµ¢áµ¢áµ¢
            Cáµ—â‚â‚â‚‚â‚‚ = Cáµ¢áµ¢â±¼â±¼
            Cáµ—â‚â‚‚â‚â‚‚ = Cáµ¢â±¼áµ¢â±¼
            Cáµ—â‚â‚â‚â‚‚ = 0.0
            Cáµ—â‚‚â‚‚â‚â‚‚ = 0.0
        end
       
        for (i,xáµ¢) in enumerate(ğ“’)
            I = xáµ¢.ğ¼
            for (j,xâ±¼) in enumerate(ğ“’)
                J = xâ±¼.ğ¼
                k[2*I-1,2*J-1] += (Cáµ—â‚â‚â‚â‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚â‚â‚‚*(Bâ‚[i]*Bâ‚‚[j]+Bâ‚‚[i]*Bâ‚[j]))*ğ‘¤
                k[2*I-1,2*J]   += (Cáµ—â‚â‚â‚‚â‚‚*Bâ‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚[j] + Cáµ—â‚â‚â‚â‚‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j])*ğ‘¤
                k[2*I,2*J-1]   += (Cáµ—â‚â‚â‚‚â‚‚*Bâ‚‚[i]*Bâ‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚â‚â‚‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j])*ğ‘¤
                k[2*I,2*J]     += (Cáµ—â‚‚â‚‚â‚‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚‚â‚‚â‚â‚‚*(Bâ‚[i]*Bâ‚‚[j]+Bâ‚‚[i]*Bâ‚[j]))*ğ‘¤
     
            end
            fint[2*I-1] += Bâ‚[i]*Î¾.Ïƒâ‚â‚*ğ‘¤ + Bâ‚‚[i]*Î¾.Ïƒâ‚â‚‚*ğ‘¤
            fint[2*I]   += Bâ‚[i]*Î¾.Ïƒâ‚â‚‚*ğ‘¤ + Bâ‚‚[i]*Î¾.Ïƒâ‚‚â‚‚*ğ‘¤
        end
    end
end    

"""
morh-coulbom
"""
function (op::Operator{:âˆ«váµ¢ÏƒdÎ©_mohr_coulomb})(ap::T;k::AbstractMatrix{Float64},fint::AbstractVector{Float64}) where T<:AbstractElement
    ğ“’ = ap.ğ“’; ğ“– = ap.ğ“–
    Î» = op.Î»
    Î¼ = op.Î¼
    c = op.c
    ğœ™ = op.ğœ™
    tol = op.tol 
    Cáµ¢áµ¢áµ¢áµ¢ = Î» + 2.0*Î¼
    Cáµ¢áµ¢â±¼â±¼ = Î»
    Cáµ¢â±¼áµ¢â±¼ = Î¼
    
    for Î¾ in enumerate(ğ“–)
        Bâ‚ = Î¾[:âˆ‚ğ­âˆ‚x]
        Bâ‚‚ = Î¾[:âˆ‚ğ­âˆ‚y]
        Ïƒâ‚â‚ = Î¾.Ïƒâ‚â‚
        Ïƒâ‚‚â‚‚ = Î¾.Ïƒâ‚‚â‚‚
        Ïƒâ‚ƒâ‚ƒ = Î¾.Ïƒâ‚ƒâ‚ƒ
        Ïƒâ‚â‚‚ = Î¾.Ïƒâ‚â‚‚
        Îµáµ–â‚â‚ = Î¾.Îµáµ–â‚â‚
        Îµáµ–â‚‚â‚‚ = Î¾.Îµáµ–â‚‚â‚‚
        Îµáµ–â‚â‚‚ = Î¾.Îµáµ–â‚â‚‚
        ğ‘¤ = Î¾.ğ‘¤
        Î”Îµâ‚â‚ = 0.0
        Î”Îµâ‚‚â‚‚ = 0.0
        Î”Îµâ‚â‚‚ = 0.0
        for (i,xáµ¢) in enumerate(ğ“’)
            Î”Îµâ‚â‚ += Bâ‚[i]*xáµ¢.Î”dâ‚
            Î”Îµâ‚‚â‚‚ += Bâ‚‚[i]*xáµ¢.Î”dâ‚‚
            Î”Îµâ‚â‚‚ += Bâ‚[i]*xáµ¢.Î”dâ‚‚ + Bâ‚‚[i]*xáµ¢.Î”dâ‚
        end 
        # predict phase
        Ïƒâ‚â‚áµ—Ê³ = Ïƒâ‚â‚ + Cáµ¢áµ¢áµ¢áµ¢*Î”Îµâ‚â‚+Cáµ¢áµ¢â±¼â±¼*Î”Îµâ‚‚â‚‚
        Ïƒâ‚‚â‚‚áµ—Ê³ = Ïƒâ‚‚â‚‚ + Cáµ¢áµ¢áµ¢áµ¢*Î”Îµâ‚‚â‚‚+Cáµ¢áµ¢â±¼â±¼*Î”Îµâ‚â‚
        Ïƒâ‚â‚‚áµ—Ê³ = Ïƒâ‚â‚‚ + Cáµ¢â±¼áµ¢â±¼*Î”Îµâ‚â‚‚
        Ïƒâ‚,Ïƒâ‚‚,nâ‚,nâ‚‚ = getÏƒâ‚™(Ïƒâ‚â‚áµ—Ê³,Ïƒâ‚‚â‚‚áµ—Ê³,Ïƒâ‚â‚‚áµ—Ê³)
        fáµ—Ê³ = Ïƒâ‚-Ïƒâ‚‚ + (Ïƒâ‚+Ïƒâ‚‚) * sin(ğœ™) - 2.0*c*cos(ğœ™)
        if fáµ—Ê³ > tol
            sinğœ™ = sin(ğœ™)
            sinÂ²ğœ™ = sin(ğœ™)*sin(ğœ™)
            sinÂ²ğœ™psinğœ™ = sinÂ²ğœ™ +sin(ğœ™) 
            sinÂ²ğœ™dsinğœ™ = sinÂ²ğœ™ -sin(ğœ™) 
            âˆ‚fCâˆ‚f=(4.0*sinÂ²ğœ™*Î»+4.0*(1.0+sinÂ²ğœ™)*Î¼)
            Î”Î³ = fáµ—Ê³/âˆ‚fCâˆ‚f
           
            Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³ - Î”Î³*(2*sinğœ™*Î»+2*((sinğœ™+1)*nâ‚[1]*nâ‚[1]+(sinğœ™-1)*nâ‚‚[1]*nâ‚‚[1])*Î¼)#ä¸Šæ ‡1å¯¹åº”ä¹‹å‰ä¸‹æ ‡1
            Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³ - Î”Î³*(2*sinğœ™*Î»+2*((sinğœ™+1)*nâ‚[2]*nâ‚[2]+(sinğœ™-1)*nâ‚‚[2]*nâ‚‚[2])*Î¼)
            Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³ - Î”Î³*2*((sinğœ™+1)*nâ‚[1]*nâ‚[2]+(sinğœ™-1)*nâ‚‚[1]*nâ‚‚[2])*Î¼
            Î¾.Îµáµ–â‚â‚ = Îµáµ–â‚â‚ + Î”Î³*((sinğœ™+1)*nâ‚[1]*nâ‚[1]+(sinğœ™-1)nâ‚‚[1]*nâ‚‚[1])
            Î¾.Îµáµ–â‚‚â‚‚ = Îµáµ–â‚‚â‚‚ + Î”Î³*((sinğœ™+1)*nâ‚[2]*nâ‚[2]+(sinğœ™-1)nâ‚‚[2]*nâ‚‚[2])
            Î¾.Îµáµ–â‚â‚‚ = Îµáµ–â‚â‚‚ + Î”Î³*(((sinğœ™+1)*nâ‚[1]*nâ‚[2]+(sinğœ™-1)nâ‚‚[1]*nâ‚‚[2]))

            Cáµ—â‚â‚â‚â‚=Cáµ¢áµ¢áµ¢áµ¢-(4.0*sinÂ²ğœ™*Î»^2 + 8.0*sinÂ²ğœ™psinğœ™*Î»*Î¼*(nâ‚[1])^2 + 8.0*(sinÂ²ğœ™dsinğœ™)*Î»*Î¼*(nâ‚‚[1])^2-8.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚[1]^2*nâ‚‚[1]^2+4.0*(sinğœ™+1)^2*Î¼^2*(nâ‚[1])^4+4.0*(sinğœ™-1)^2*Î¼^2*(nâ‚‚[1])^4)/âˆ‚fCâˆ‚f
            Cáµ—â‚‚â‚‚â‚‚â‚‚=Cáµ¢áµ¢áµ¢áµ¢-(4.0*sinÂ²ğœ™*Î»^2 + 8.0*sinÂ²ğœ™psinğœ™*Î»*Î¼*(nâ‚[2])^2 + 8.0*(sinÂ²ğœ™dsinğœ™)*Î»*Î¼*(nâ‚‚[2])^2-8.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚[2]^2*nâ‚‚[2]^2+4.0*(sinğœ™+1)^2*Î¼^2*(nâ‚[2])^4+4.0*(sinğœ™-1)^2*Î¼^2*(nâ‚‚[2])^4)/âˆ‚fCâˆ‚f
            Cáµ—â‚â‚â‚‚â‚‚=Cáµ¢áµ¢â±¼â±¼-(4.0*sinÂ²ğœ™*Î»^2 + 4.0*sinÂ²ğœ™psinğœ™*Î»*Î¼*((nâ‚[1])^2+(nâ‚[2])^2)+4.0*(sinÂ²ğœ™dsinğœ™)*Î»*Î¼*((nâ‚‚[1])^2+(nâ‚‚[2])^2)+4.0*(sinğœ™+1)^2*Î¼^2*(nâ‚[1])^2*(nâ‚[2])^2-4.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*((nâ‚‚[1])^2*(nâ‚[2])^2+(nâ‚[1])^2*(nâ‚‚[2])^2)+4.0*(sinğœ™-1)^2*Î¼^2*(nâ‚‚[1])^2*(nâ‚‚[2])^2)/âˆ‚fCâˆ‚f
            Cáµ—â‚â‚‚â‚â‚‚=Cáµ¢â±¼áµ¢â±¼-2.0(-8.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚[1]*nâ‚[2]*nâ‚‚[1]*nâ‚‚[2]+4.0*(sinğœ™+1)^2*Î¼^2*(nâ‚[1]*nâ‚[2])^2+4.0*(sinğœ™-1)^2*Î¼^2*(nâ‚‚[1]*nâ‚‚[2])^2)/âˆ‚fCâˆ‚f
            Cáµ—â‚â‚â‚â‚‚ = - (4.0*sinÂ²ğœ™psinğœ™*Î»*Î¼*nâ‚[1]*nâ‚[2] + 4.0*(sinÂ²ğœ™dsinğœ™)*Î»*Î¼*nâ‚‚[1]*nâ‚‚[2]-4.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚‚[1]^2*nâ‚[1]*nâ‚[2]-4.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚[1]^2*nâ‚‚[1]*nâ‚‚[2]+4.0*(sinğœ™+1)^2*Î¼^2*(nâ‚[1])^3*nâ‚[2]+4.0*(sinğœ™-1)^2*Î¼^2*(nâ‚‚[1])^3*nâ‚‚[2])/âˆ‚fCâˆ‚f
            Cáµ—â‚‚â‚‚â‚â‚‚ = - (4.0*sinÂ²ğœ™psinğœ™*Î»*Î¼*nâ‚[2]*nâ‚[1] + 4.0*(sinÂ²ğœ™dsinğœ™)*Î»*Î¼*nâ‚‚[2]*nâ‚‚[1]-4.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚‚[2]^2*nâ‚[2]*nâ‚[1]-4.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚[2]^2*nâ‚‚[2]*nâ‚‚[1]+4.0*(sinğœ™+1)^2*Î¼^2*(nâ‚[2])^3*nâ‚[1]+4.0*(sinğœ™-1)^2*Î¼^2*(nâ‚‚[2])^3*nâ‚‚[1])/âˆ‚fCâˆ‚f
            #println(Cáµ—â‚â‚â‚â‚)
            #println(Cáµ—â‚‚â‚‚â‚‚â‚‚)
            #println(Cáµ—â‚â‚â‚‚â‚‚)
            #println(Cáµ—â‚â‚‚â‚â‚‚)
            #println(Cáµ—â‚â‚â‚â‚‚)
            #println(Cáµ—â‚‚â‚‚â‚â‚‚)
        else
            Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³
            Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³
            Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³
            Cáµ—â‚â‚â‚â‚ = Cáµ¢áµ¢áµ¢áµ¢
            Cáµ—â‚‚â‚‚â‚‚â‚‚ = Cáµ¢áµ¢áµ¢áµ¢
            Cáµ—â‚â‚â‚‚â‚‚ = Cáµ¢áµ¢â±¼â±¼
            Cáµ—â‚â‚‚â‚â‚‚ = Cáµ¢â±¼áµ¢â±¼
            Cáµ—â‚â‚â‚â‚‚ = 0.0
            Cáµ—â‚‚â‚‚â‚â‚‚ = 0.0
        end
       # if isnan(Ïƒâ‚â‚)
       #    
       #       Ïƒâ‚â‚ = NaN
       #       error("ç¨‹åºç»ˆæ­¢ï¼šÏƒâ‚â‚çš„å€¼ä¸ºNaN")
       # end
        # println(Cáµ—â‚â‚â‚â‚)
        # println(Cáµ—â‚‚â‚‚â‚‚â‚‚)
        # println(Cáµ—â‚â‚â‚‚â‚‚)
        # println(Cáµ—â‚â‚‚â‚â‚‚)
       
        for (i,xáµ¢) in enumerate(ğ“’)
            I = xáµ¢.ğ¼
            for (j,xâ±¼) in enumerate(ğ“’)
                J = xâ±¼.ğ¼
                k[2*I-1,2*J-1] += (Cáµ—â‚â‚â‚â‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚â‚â‚‚*(Bâ‚[i]*Bâ‚‚[j]+Bâ‚‚[i]*Bâ‚[j]))*ğ‘¤
                k[2*I-1,2*J]   += (Cáµ—â‚â‚â‚‚â‚‚*Bâ‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚[j] + Cáµ—â‚â‚â‚â‚‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j])*ğ‘¤
                k[2*I,2*J-1]   += (Cáµ—â‚â‚â‚‚â‚‚*Bâ‚‚[i]*Bâ‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚â‚â‚‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j])*ğ‘¤
                k[2*I,2*J]     += (Cáµ—â‚‚â‚‚â‚‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚‚â‚‚â‚â‚‚*(Bâ‚[i]*Bâ‚‚[j]+Bâ‚‚[i]*Bâ‚[j]))*ğ‘¤
     
            end
            fint[2*I-1] += Bâ‚[i]*Î¾.Ïƒâ‚â‚*ğ‘¤ + Bâ‚‚[i]*Î¾.Ïƒâ‚â‚‚*ğ‘¤
            fint[2*I]   += Bâ‚[i]*Î¾.Ïƒâ‚â‚‚*ğ‘¤ + Bâ‚‚[i]*Î¾.Ïƒâ‚‚â‚‚*ğ‘¤
    
        end
    end
end    


"""
frictional-contact
"""
function (op::Operator{:âˆ«váµ¢ÏƒdÎ©_frictional_contact})(ap::T;k::AbstractMatrix{Float64},fint::AbstractVector{Float64}) where T<:AbstractElement
    ğ“’ = ap.ğ“’; ğ“– = ap.ğ“–
    Î¼Ì„ = op.Î¼Ì„ 
    E = op.E
    Î½ = op.Î½
    Î» = E*Î½/(1.0+Î½)/(1.0-2.0*Î½)
    Î¼ = 0.5*E/(1.0+Î½)
    Î· = 1e-6
    nodes = op.nodes
    
    for Î¾ in ğ“–
        N = Î¾[:ğ­]
        Bâ‚ = Î¾[:âˆ‚ğ­âˆ‚x]
        Bâ‚‚ = Î¾[:âˆ‚ğ­âˆ‚y]
        Ïƒâ‚â‚ = Î¾.Ïƒâ‚â‚
        Ïƒâ‚‚â‚‚ = Î¾.Ïƒâ‚‚â‚‚
        Ïƒâ‚â‚‚ = Î¾.Ïƒâ‚â‚‚
        ğ‘¤   = Î¾.ğ‘¤
        Îµâ‚â‚ = 0.0
        Îµâ‚‚â‚‚ = 0.0
        Îµâ‚â‚‚ = 0.0
        Î”Îµâ‚â‚ = 0.0
        Î”Îµâ‚‚â‚‚ = 0.0
        Î”Îµâ‚â‚‚ = 0.0
        v = 0.0
        âˆ‚vâˆ‚x = 0.0
        âˆ‚vâˆ‚y = 0.0
      
        for (i,xáµ¢) in enumerate(ğ“’)
            Îµâ‚â‚ += Bâ‚[i]*xáµ¢.dâ‚
            Îµâ‚‚â‚‚ += Bâ‚‚[i]*xáµ¢.dâ‚‚
            Îµâ‚â‚‚ += Bâ‚[i]*xáµ¢.dâ‚‚ + Bâ‚‚[i]*xáµ¢.dâ‚
            Î”Îµâ‚â‚ += Bâ‚[i]*xáµ¢.Î”dâ‚
            Î”Îµâ‚‚â‚‚ += Bâ‚‚[i]*xáµ¢.Î”dâ‚‚
            Î”Îµâ‚â‚‚ += Bâ‚[i]*xáµ¢.Î”dâ‚‚ + Bâ‚‚[i]*xáµ¢.Î”dâ‚
            v += N[i]*xáµ¢.v
            âˆ‚vâˆ‚x += Bâ‚[i]*xáµ¢.v
            âˆ‚vâˆ‚y += Bâ‚‚[i]*xáµ¢.v
        end 

        #normâˆ‡v = (âˆ‚vâˆ‚x^2+âˆ‚vâˆ‚y^2)^0.5
        #nâ‚ = âˆ‚vâˆ‚x/normâˆ‡v
        #nâ‚‚ = âˆ‚vâˆ‚y/normâˆ‡v
        #sâ‚ = nâ‚‚
        #sâ‚‚ = -nâ‚
        Î“tmp = Set{Int}()
        Î“dam = Set{Int}()
        Î“final = Set{Int}()
        #step1 æ‰¾åˆ°çš„æ‰€æœ‰v>0.98çš„ç‚¹
        for (i,xáµ¢) in enumerate(ğ“’)
            if xáµ¢.v > 0.98   
                #step2 å¹¶å°†å…¶å­˜å…¥Î“tmpä¸­
                push!(Î“tmp, i)
            end
            if xáµ¢.v > 0.05   
                push!(Î“dam, i)
            end

        end
    
       
        while !isempty(Î“tmp)
         #step3 æ‰¾åˆ°Î“tmpä¸­æœ€å¤§væœ€å¤§çš„ç‚¹

            max_value = -Inf
            max_node = nothing
            
            for i in Î“tmp
                if v > max_value
                    max_value = v
                    max_node = nodes[i]
                end
            end
          
            for node in Î“tmp
               
                distance = norm(nodes[max_node] - nodes[node])
                #step4 
                if distance <= l
                    deleteat!(Î“tmp, findall(x -> x == node, Î“tmp))
                    push!(Î“final, nodes[max_node])
                end
            end
          
            Î“tmp = setdiff(Î“tmp, Î“final)
        end
        #stpe5 å°†Î“finalä¸­çš„ç‚¹è¿›è¡Œæ’åº
        sorted_nodes = sort(collect(Î“final), by = node -> nodes[node][1])  
        crack_path = Vector{Tuple{Float64, Float64}}()
    
        normals = []
        slips = []
        #è®¡ç®—æ¯ä¸€ä¸ªçº¿æ®µçš„æ³•å‘é‡å’Œåˆ‡å‘é‡
        for i in 1:length(sorted_nodes)-1
            node1 = nodes[sorted_nodes[i]]
            node2 = nodes[sorted_nodes[i + 1]]
            segment = (node1, node2)
    
            s = normalize!(node2 - node1)
    

            n = (-s[2], s[1])
            push!(normals, n)

            push!(crack_path, segment)

        end
        for node in Î“dam
            min_distance = Inf
            for i in 1:length(crack_path) - 1
                segment = crack_path[i]
                distance = pointdistfromseg(segment, node)
                if distance < min_distance
                    min_distance = distance
                    nearest_segment = segment
                end
            end
            node.n = nearest_segment.n
            node.s = nearest_segment.s
            nâ‚ = n[1]
            nâ‚‚ = n[2]
            sâ‚ = nâ‚‚
            sâ‚‚ = -nâ‚

        end  
        if v< 0.05
            nâ‚ = 0.0
            nâ‚‚ = 0.0
            sâ‚ = 0.0
            sâ‚‚ = 0.0
            
        end

        # predict phase
        Îµâ‚™ = Îµâ‚â‚*nâ‚*nâ‚ + Îµâ‚‚â‚‚*nâ‚‚*nâ‚‚ + Îµâ‚â‚‚*nâ‚*nâ‚‚

        Ïƒâ‚â‚áµ—Ê³ = (Î»+2Î¼)*Îµâ‚â‚ + Î»*Îµâ‚‚â‚‚
        Ïƒâ‚‚â‚‚áµ—Ê³ = Î»*Îµâ‚â‚ + (Î»+2Î¼)*Îµâ‚‚â‚‚
        Ïƒâ‚â‚‚áµ—Ê³ = Î¼*Îµâ‚â‚‚

        Ï„ = Ïƒâ‚â‚áµ—Ê³*nâ‚*sâ‚ + Ïƒâ‚‚â‚‚áµ—Ê³*nâ‚‚*sâ‚‚ + Ïƒâ‚â‚‚áµ—Ê³*(nâ‚*sâ‚‚+nâ‚‚*sâ‚)
        Ïƒ = Ïƒâ‚â‚áµ—Ê³*nâ‚*nâ‚ + Ïƒâ‚‚â‚‚áµ—Ê³*nâ‚‚*nâ‚‚ + 2.0*Ïƒâ‚â‚‚áµ—Ê³*nâ‚*nâ‚‚
        ğ‘ = -Ïƒ

        ğ‘“  = abs(Ï„) - Î¼Ì„ *ğ‘
        if abs(1.0-v) < 2e-2
             Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³
             Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³
             Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³
             Cáµ—â‚â‚â‚â‚ = Î»+2Î¼
             Cáµ—â‚‚â‚‚â‚‚â‚‚ = Î»+2Î¼
             Cáµ—â‚â‚â‚‚â‚‚ = Î» 
             Cáµ—â‚‚â‚‚â‚â‚ = Î»
             Cáµ—â‚â‚‚â‚â‚‚ = Î¼ 
             Cáµ—â‚â‚â‚â‚‚ = 0.0
             Cáµ—â‚‚â‚‚â‚â‚‚ = 0.0
             Cáµ—â‚â‚‚â‚â‚ = 0.0
             Cáµ—â‚â‚‚â‚‚â‚‚ = 0.0
        else
            if Îµâ‚™ > 0.0
                Î¾.Ïƒâ‚â‚ = (v^2+Î·)*Ïƒâ‚â‚áµ—Ê³
                Î¾.Ïƒâ‚‚â‚‚ = (v^2+Î·)*Ïƒâ‚‚â‚‚áµ—Ê³
                Î¾.Ïƒâ‚â‚‚ = (v^2+Î·)*Ïƒâ‚â‚‚áµ—Ê³

                Cáµ—â‚â‚â‚â‚ = (v^2+Î·)*(Î»+2Î¼)
                Cáµ—â‚‚â‚‚â‚‚â‚‚ = (v^2+Î·)*(Î»+2Î¼)
                Cáµ—â‚â‚â‚‚â‚‚ = (v^2+Î·)*Î» 
                Cáµ—â‚‚â‚‚â‚â‚ = (v^2+Î·)*Î»
                Cáµ—â‚â‚‚â‚â‚‚ = (v^2+Î·)*Î¼ 
                Cáµ—â‚â‚â‚â‚‚ = 0.0
                Cáµ—â‚‚â‚‚â‚â‚‚ = 0.0
                Cáµ—â‚â‚‚â‚â‚ = 0.0
                Cáµ—â‚â‚‚â‚‚â‚‚ = 0.0
            else
                if ğ‘“ < 0.0
                    Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³
                    Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³
                    Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³
    
                    Cáµ—â‚â‚â‚â‚ = Î»+2Î¼
                    Cáµ—â‚‚â‚‚â‚‚â‚‚ = Î»+2Î¼
                    Cáµ—â‚â‚â‚‚â‚‚ = Î» 
                    Cáµ—â‚‚â‚‚â‚â‚ = Î»
                    Cáµ—â‚â‚‚â‚â‚‚ = Î¼ 
                    Cáµ—â‚â‚â‚â‚‚ = 0.0
                    Cáµ—â‚‚â‚‚â‚â‚‚ = 0.0
                    Cáµ—â‚â‚‚â‚â‚ = 0.0
                    Cáµ—â‚â‚‚â‚‚â‚‚ = 0.0

                else
                    signÏ„ = sign(Ï„)
                    Cá¶ â‚â‚â‚â‚ = -Î¼Ì„*signÏ„*(Î»+2.0*Î¼*nâ‚*nâ‚)*2.0*nâ‚*sâ‚
                    Cá¶ â‚‚â‚‚â‚‚â‚‚ = -Î¼Ì„*signÏ„*(Î»+2.0*Î¼*nâ‚‚*nâ‚‚)*2.0*nâ‚‚*sâ‚‚
                    Cá¶ â‚â‚â‚‚â‚‚ = -Î¼Ì„*signÏ„*(Î»+2.0*Î¼*nâ‚‚*nâ‚‚)*2.0*nâ‚*sâ‚
                    Cá¶ â‚‚â‚‚â‚â‚ = -Î¼Ì„*signÏ„*(Î»+2.0*Î¼*nâ‚*nâ‚)*2.0*nâ‚‚*sâ‚‚
                    Cá¶ â‚â‚â‚â‚‚ = -Î¼Ì„*signÏ„*2.0*Î¼*nâ‚*nâ‚‚*2.0*nâ‚*sâ‚
                    Cá¶ â‚â‚‚â‚â‚ = -Î¼Ì„*signÏ„*(Î»+2.0*Î¼*nâ‚*nâ‚)*(nâ‚*sâ‚‚+nâ‚‚*sâ‚)
                    Cá¶ â‚‚â‚‚â‚â‚‚ = -Î¼Ì„*signÏ„*2.0*Î¼*nâ‚*nâ‚‚*2.0*nâ‚‚*sâ‚‚ 
                    Cá¶ â‚â‚‚â‚‚â‚‚ = -Î¼Ì„*signÏ„*(Î»+2.0*Î¼*nâ‚‚*nâ‚‚)*(nâ‚*sâ‚‚+nâ‚‚*sâ‚)
                    Cá¶ â‚â‚‚â‚â‚‚ = -Î¼Ì„*signÏ„*2.0*Î¼*nâ‚*nâ‚‚*(nâ‚*sâ‚‚+nâ‚‚*sâ‚)
                
                    CÊ³â‚â‚â‚â‚ =  Î¼*(nâ‚*sâ‚+nâ‚*sâ‚)*(nâ‚*sâ‚+nâ‚*sâ‚)
                    CÊ³â‚‚â‚‚â‚‚â‚‚ =  Î¼*(nâ‚‚*sâ‚‚+nâ‚‚*sâ‚‚)*(nâ‚‚*sâ‚‚+nâ‚‚*sâ‚‚)
                    CÊ³â‚â‚â‚‚â‚‚ =  Î¼*(nâ‚‚*sâ‚‚+nâ‚‚*sâ‚‚)*(nâ‚*sâ‚+nâ‚*sâ‚)
                    CÊ³â‚‚â‚‚â‚â‚ =  Î¼*(nâ‚*sâ‚+nâ‚*sâ‚)*(nâ‚‚*sâ‚‚+nâ‚‚*sâ‚‚)
                    CÊ³â‚â‚â‚â‚‚ =  Î¼*(nâ‚*sâ‚‚+nâ‚‚*sâ‚)*(nâ‚*sâ‚+nâ‚*sâ‚)
                    CÊ³â‚â‚‚â‚â‚ =  Î¼*(nâ‚*sâ‚+nâ‚*sâ‚)*(nâ‚*sâ‚‚+nâ‚‚*sâ‚)
                    CÊ³â‚‚â‚‚â‚â‚‚ =  Î¼*(nâ‚*sâ‚‚+nâ‚‚*sâ‚)*(nâ‚‚*sâ‚‚+nâ‚‚*sâ‚‚)
                    CÊ³â‚â‚‚â‚‚â‚‚ =  Î¼*(nâ‚‚*sâ‚‚+nâ‚‚*sâ‚‚)*(nâ‚*sâ‚‚+nâ‚‚*sâ‚)
                    CÊ³â‚â‚‚â‚â‚‚ =  Î¼*(nâ‚*sâ‚‚+nâ‚‚*sâ‚)*(nâ‚*sâ‚‚+nâ‚‚*sâ‚)

                    Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³ + (1.0-v^2-Î·)*(Î¼Ì„*ğ‘*signÏ„ - Ï„)*2*nâ‚*sâ‚
                    Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³ + (1.0-v^2-Î·)*(Î¼Ì„*ğ‘*signÏ„ - Ï„)*2*nâ‚‚*sâ‚‚
                    Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³ + (1.0-v^2-Î·)*(Î¼Ì„*ğ‘*signÏ„ - Ï„)*(nâ‚*sâ‚‚+nâ‚‚*sâ‚)

                    Cáµ—â‚â‚â‚â‚ = Î»+2Î¼ + (1.0-v^2-Î·)*(Cá¶ â‚â‚â‚â‚-CÊ³â‚â‚â‚â‚)
                    Cáµ—â‚‚â‚‚â‚‚â‚‚ = Î»+2Î¼ + (1.0-v^2-Î·)*(Cá¶ â‚‚â‚‚â‚‚â‚‚-CÊ³â‚‚â‚‚â‚‚â‚‚)
                    Cáµ—â‚â‚â‚‚â‚‚ = Î» + (1.0-v^2-Î·)*(Cá¶ â‚â‚â‚‚â‚‚-CÊ³â‚â‚â‚‚â‚‚)
                    Cáµ—â‚‚â‚‚â‚â‚ = Î» + (1.0-v^2-Î·)*(Cá¶ â‚‚â‚‚â‚â‚-CÊ³â‚‚â‚‚â‚â‚)
                    Cáµ—â‚â‚‚â‚â‚‚ = Î¼ + (1.0-v^2-Î·)*(Cá¶ â‚â‚‚â‚â‚‚-CÊ³â‚â‚‚â‚â‚‚)
                    Cáµ—â‚â‚â‚â‚‚ = (1.0-v^2-Î·)*(Cá¶ â‚â‚â‚â‚‚-CÊ³â‚â‚â‚â‚‚)
                    Cáµ—â‚â‚‚â‚â‚ = (1.0-v^2-Î·)*(Cá¶ â‚â‚‚â‚â‚-CÊ³â‚â‚‚â‚â‚)
                    Cáµ—â‚‚â‚‚â‚â‚‚ = (1.0-v^2-Î·)*(Cá¶ â‚‚â‚‚â‚â‚‚-CÊ³â‚‚â‚‚â‚â‚‚)
                    Cáµ—â‚â‚‚â‚‚â‚‚ = (1.0-v^2-Î·)*(Cá¶ â‚â‚‚â‚‚â‚‚-CÊ³â‚â‚‚â‚‚â‚‚)
                end
            end
        end

        for (i,xáµ¢) in enumerate(ğ“’)
            I = xáµ¢.ğ¼
            for (j,xâ±¼) in enumerate(ğ“’)
             J = xâ±¼.ğ¼
             k[2*I-1,2*J-1] += (Cáµ—â‚â‚â‚â‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚â‚â‚â‚‚*Bâ‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚‚â‚â‚*Bâ‚‚[i]*Bâ‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j])*ğ‘¤
             k[2*I-1,2*J]   += (Cáµ—â‚â‚â‚â‚‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚â‚â‚‚â‚‚*Bâ‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚[j] + Cáµ—â‚â‚‚â‚‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j])*ğ‘¤
             k[2*I,2*J-1]   += (Cáµ—â‚â‚‚â‚â‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚[i]*Bâ‚‚[j] + Cáµ—â‚‚â‚‚â‚â‚*Bâ‚‚[i]*Bâ‚[j] + Cáµ—â‚‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j])*ğ‘¤
             k[2*I,2*J]     += (Cáµ—â‚â‚‚â‚â‚‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚â‚‚â‚‚â‚‚*Bâ‚[i]*Bâ‚‚[j] + Cáµ—â‚‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚[j] + Cáµ—â‚‚â‚‚â‚‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j])*ğ‘¤
           end
           fint[2*I-1] += (Bâ‚[i]*Î¾.Ïƒâ‚â‚ + Bâ‚‚[i]*Î¾.Ïƒâ‚â‚‚)*ğ‘¤
           fint[2*I]   += (Bâ‚[i]*Î¾.Ïƒâ‚â‚‚ + Bâ‚‚[i]*Î¾.Ïƒâ‚‚â‚‚)*ğ‘¤
       end   
    end
end 
function calculate_n_and_s_vectors(nodes, v, l)
        Î“tmp = Set{Int}()
        Î“dam = Set{Int}()
        Î“final = Set{Int}()
        #step1 æ‰¾åˆ°çš„æ‰€æœ‰v>0.98çš„ç‚¹
        for (i,xáµ¢) in enumerate(ğ“’)
            if xáµ¢.v > 0.98   
                #step2 å¹¶å°†å…¶å­˜å…¥Î“tmpä¸­
                push!(Î“tmp, i)
            end
            if xáµ¢.v > 0.05   
                push!(Î“dam, i)
            end
        end
    
        
        while !isempty(Î“tmp)
         #step3 æ‰¾åˆ°rtmpä¸­æœ€å¤§væœ€å¤§çš„ç‚¹
            max_v, max_node = findmax(v[collect(Î“tmp)])
         
            for node in Î“tmp
               
                distance = norm(nodes[max_node] - nodes[node])
                #step4 
                if distance <= l
                    deleteat!(Î“tmp, findall(x -> x == node, Î“tmp))
                    push!(Î“final, nodes[max_node])
                end
            end
          
            Î“tmp = setdiff(Î“tmp, Î“final)
        end
        #stpe5 å°†Î“finalä¸­çš„ç‚¹è¿›è¡Œæ’åº
        sorted_nodes = sort(collect(Î“final), by = node -> nodes[node][1])  
        crack_path = Vector{Tuple{Float64, Float64}}()
    
        normals = []
        slips = []
        #è®¡ç®—æ¯ä¸€ä¸ªçº¿æ®µçš„æ³•å‘é‡å’Œåˆ‡å‘é‡
        for i in 1:length(sorted_nodes)-1
            node1 = nodes[sorted_nodes[i]]
            node2 = nodes[sorted_nodes[i + 1]]
            segment = (node1, node2)
    
            s = normalize!(node2 - node1)
    

            n = (-s[2], s[1])
            push!(normals, n)

            push!(crack_path, segment)

        end
        for node in Î“dam
            min_distance = Inf
            for i in 1:length(crack_path) - 1
                distance = pointdistfromseg(segment, node)
                if distance < min_distance
                    min_distance = distance
                    nearest_segment = segment
                end
            end
            node.n = nearest_segment.n
            node.s = nearest_segment.s

        end  
        return normals, slips
    end
"""
frictional-contact2
"""
function (op::Operator{:âˆ«váµ¢ÏƒdÎ©_frictional_contact_2})(ap::T;k::AbstractMatrix{Float64},fint::AbstractVector{Float64}) where T<:AbstractElement
    ğ“’ = ap.ğ“’; ğ“– = ap.ğ“–
    Î¼Ì„ = op.Î¼Ì„ 
    Î· = op.Î·
    E = op.E
    Î½ = op.Î½
    Î» = E*Î½/(1.0+Î½)/(1.0-2.0*Î½)
    Î¼ = 0.5*E/(1.0+Î½)
    tol = op.tol 
    Cáµ¢áµ¢áµ¢áµ¢ = E/(1-Î½^2)
    Cáµ¢áµ¢â±¼â±¼ = E*Î½/(1-Î½^2)
    Cáµ¢â±¼áµ¢â±¼ = E/2/(1+Î½)
    
    for Î¾ in ğ“–
        N = Î¾[:ğ­]
        Bâ‚ = Î¾[:âˆ‚ğ­âˆ‚x]
        Bâ‚‚ = Î¾[:âˆ‚ğ­âˆ‚y]
        Ïƒâ‚â‚ = Î¾.Ïƒâ‚â‚
        Ïƒâ‚‚â‚‚ = Î¾.Ïƒâ‚‚â‚‚
        Ïƒâ‚â‚‚ = Î¾.Ïƒâ‚â‚‚
        ğ‘¤   = Î¾.ğ‘¤
        Îµâ‚â‚ = 0.0
        Îµâ‚‚â‚‚ = 0.0
        Îµâ‚â‚‚ = 0.0
        Î”Îµâ‚â‚ = 0.0
        Î”Îµâ‚‚â‚‚ = 0.0
        Î”Îµâ‚â‚‚ = 0.0
        v = 0.0
        âˆ‚vâˆ‚x = 0.0
        âˆ‚vâˆ‚y = 0.0
      
        for (i,xáµ¢) in enumerate(ğ“’)
            Îµâ‚â‚ += Bâ‚[i]*xáµ¢.dâ‚
            Îµâ‚‚â‚‚ += Bâ‚‚[i]*xáµ¢.dâ‚‚
            Îµâ‚â‚‚ += Bâ‚[i]*xáµ¢.dâ‚‚ + Bâ‚‚[i]*xáµ¢.dâ‚
            Î”Îµâ‚â‚ += Bâ‚[i]*xáµ¢.Î”dâ‚
            Î”Îµâ‚‚â‚‚ += Bâ‚‚[i]*xáµ¢.Î”dâ‚‚
            Î”Îµâ‚â‚‚ += Bâ‚[i]*xáµ¢.Î”dâ‚‚ + Bâ‚‚[i]*xáµ¢.Î”dâ‚
            v += N[i]*xáµ¢.v
            âˆ‚vâˆ‚x += Bâ‚[i]*xáµ¢.v
            âˆ‚vâˆ‚y += Bâ‚‚[i]*xáµ¢.v
        end 
        #println(Îµâ‚â‚)
        normâˆ‡v = (âˆ‚vâˆ‚x^2+âˆ‚vâˆ‚y^2)^0.5#n = âˆ‡v/norm(âˆ‡v)
        nâ‚ = (âˆ‚vâˆ‚x)/(normâˆ‡v)
        nâ‚‚ = (âˆ‚vâˆ‚y)/(normâˆ‡v)
        sâ‚ = nâ‚‚
        sâ‚‚ = -nâ‚


       # println(666,âˆ‚vâˆ‚x,666,âˆ‚vâˆ‚y,666,normâˆ‡v)
        
        # predict phase
        Îµâ‚™ = Îµâ‚â‚*nâ‚*nâ‚ + Îµâ‚‚â‚‚*nâ‚‚*nâ‚‚ + Îµâ‚â‚‚*nâ‚*nâ‚‚#2.æ‰€ä»¥è¿™é‡Œå°±ç®—ä¸€ä¸ªå°±è¡Œäº†

        Ïƒâ‚â‚áµ—Ê³ = Ïƒâ‚â‚ + Cáµ¢áµ¢áµ¢áµ¢*Î”Îµâ‚â‚ + Cáµ¢áµ¢â±¼â±¼*Î”Îµâ‚‚â‚‚
        Ïƒâ‚‚â‚‚áµ—Ê³ = Ïƒâ‚‚â‚‚ + Cáµ¢áµ¢áµ¢áµ¢*Î”Îµâ‚‚â‚‚ + Cáµ¢áµ¢â±¼â±¼*Î”Îµâ‚â‚
        Ïƒâ‚â‚‚áµ—Ê³ = Ïƒâ‚â‚‚ + Cáµ¢â±¼áµ¢â±¼*Î”Îµâ‚â‚‚
        
        Ï„ = Ïƒâ‚â‚áµ—Ê³*nâ‚*sâ‚ + Ïƒâ‚‚â‚‚áµ—Ê³*nâ‚‚*sâ‚‚ + Ïƒâ‚â‚‚áµ—Ê³*nâ‚*sâ‚‚ + Ïƒâ‚â‚‚áµ—Ê³*nâ‚‚*sâ‚
        Ïƒ = Ïƒâ‚â‚áµ—Ê³*nâ‚*nâ‚ + Ïƒâ‚‚â‚‚áµ—Ê³*nâ‚‚*nâ‚‚ + Ïƒâ‚â‚‚áµ—Ê³*nâ‚*nâ‚‚

        

        ğ‘“  = abs(Ï„) + Î¼Ì„  * Ïƒ
        #println(sign(Ï„))
        #println(ğ‘“ )
       if (1-v) < tol  #v=1  
          Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³
          Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³
          Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³
          Cáµ—â‚â‚â‚â‚ = Cáµ¢áµ¢áµ¢áµ¢
          Cáµ—â‚‚â‚‚â‚‚â‚‚ = Cáµ¢áµ¢áµ¢áµ¢
          Cáµ—â‚â‚â‚‚â‚‚ = Cáµ¢áµ¢â±¼â±¼ 
          Cáµ—â‚‚â‚‚â‚â‚ = Cáµ¢áµ¢â±¼â±¼
          Cáµ—â‚â‚‚â‚â‚‚ = Cáµ¢â±¼áµ¢â±¼ 
          Cáµ—â‚â‚â‚â‚‚ = 0.0
          Cáµ—â‚‚â‚‚â‚â‚‚ = 0.0
          Cáµ—â‚â‚‚â‚â‚ = 0.0
          Cáµ—â‚â‚‚â‚‚â‚‚ = 0.0
        else
            if Îµâ‚™ > 0.0  #open
               Ïƒâ‚â‚áµ—Ê³ = Ïƒâ‚â‚ + (v^2+Î·)*(Cáµ¢áµ¢áµ¢áµ¢*Î”Îµâ‚â‚ + Cáµ¢áµ¢â±¼â±¼*Î”Îµâ‚‚â‚‚)
               Ïƒâ‚‚â‚‚áµ—Ê³ = Ïƒâ‚‚â‚‚ + (v^2+Î·)*(Cáµ¢áµ¢áµ¢áµ¢*Î”Îµâ‚‚â‚‚ + Cáµ¢áµ¢â±¼â±¼*Î”Îµâ‚â‚)
               Ïƒâ‚â‚‚áµ—Ê³ = Ïƒâ‚â‚‚ + (v^2+Î·)*Cáµ¢â±¼áµ¢â±¼*Î”Îµâ‚â‚‚
        
               Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³
               Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³
               Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³

               Cáµ—â‚â‚â‚â‚ = (v^2+Î·)*Cáµ¢áµ¢áµ¢áµ¢
               Cáµ—â‚‚â‚‚â‚‚â‚‚ = (v^2+Î·)*Cáµ¢áµ¢áµ¢áµ¢
               Cáµ—â‚â‚â‚‚â‚‚ = (v^2+Î·)*Cáµ¢áµ¢â±¼â±¼ 
               Cáµ—â‚‚â‚‚â‚â‚ = (v^2+Î·)*Cáµ¢áµ¢â±¼â±¼
               Cáµ—â‚â‚‚â‚â‚‚ = (v^2+Î·)*Cáµ¢â±¼áµ¢â±¼ 
               Cáµ—â‚â‚â‚â‚‚ = 0.0
               Cáµ—â‚‚â‚‚â‚â‚‚ = 0.0
               Cáµ—â‚â‚‚â‚â‚ = 0.0
               Cáµ—â‚â‚‚â‚‚â‚‚ = 0.0
            else
                if ğ‘“ < tol

                   Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³
                   Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³
                   Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³
                   Cáµ—â‚â‚â‚â‚ = Cáµ¢áµ¢áµ¢áµ¢
                   Cáµ—â‚‚â‚‚â‚‚â‚‚ = Cáµ¢áµ¢áµ¢áµ¢
                   Cáµ—â‚â‚â‚‚â‚‚ = Cáµ¢áµ¢â±¼â±¼ 
                   Cáµ—â‚‚â‚‚â‚â‚ = Cáµ¢áµ¢â±¼â±¼
                   Cáµ—â‚â‚‚â‚â‚‚ = Cáµ¢â±¼áµ¢â±¼ 
                   Cáµ—â‚â‚â‚â‚‚ = 0.0             
                   Cáµ—â‚‚â‚‚â‚â‚‚ = 0.0
                   Cáµ—â‚â‚‚â‚â‚ = 0.0
                   Cáµ—â‚â‚‚â‚‚â‚‚ = 0.0
                else
                  âˆ‚fCâˆ‚f = Î»*Î¼Ì„ ^2.0 + 2.0*(0.5+Î¼Ì„ ^2.0)*Î¼
                  Î”Î³ = fáµ—Ê³/âˆ‚fCâˆ‚f
                  #Ïƒáµ¢â±¼â½â¿âºÂ¹â¾ = Ïƒáµ¢â±¼áµ—Ê³ - Î”Î³*Cáµ¢â±¼â‚–â‚—*âˆ‚fáµ—Ê³/âˆ‚Ïƒâ‚–â‚—  
                  #Ïƒáµ¢â±¼      = Ïƒáµ¢â±¼áµ—Ê³ - Î”Î³*(sign(Ï„)*Î¼*(náµ¢*sâ±¼ +nâ±¼*sáµ¢) + Î¼Ì„ *(2*Î¼*náµ¢*nâ±¼))
                  Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³ - (1-v^2+Î·)*Î”Î³*(sign(Ï„)*Î¼*2.0*nâ‚*sâ‚ + Î¼Ì„ *(Î»+2*Î¼*nâ‚*nâ‚)) 
                  Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³ - (1-v^2+Î·)*Î”Î³*(sign(Ï„)*Î¼*2.0*nâ‚‚*sâ‚‚ + Î¼Ì„ *(Î»+2*Î¼*nâ‚‚*nâ‚‚)) 
                  Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³ - (1-v^2+Î·)*Î”Î³*(sign(Ï„)*Î¼*(nâ‚*sâ‚‚+nâ‚‚*sâ‚) + Î¼Ì„ *(2*Î¼*nâ‚*nâ‚‚)) 
     
                  #Cáµ¢â±¼â‚–â‚—áµ— = Cáµ¢â±¼â‚–â‚— - (4.0*Î¼^2.0*Î¼Ì„ ^2.0*náµ¢*nâ±¼*nâ‚–*nâ‚— + Î»^2.0*Î´áµ¢â±¼*Î´â‚–â‚—*Î¼Ì„ ^2.0 + sign(Ï„)^2.0*Î¼^2.0*(náµ¢*sâ±¼+nâ±¼*sáµ¢)*(nâ‚–*sâ‚—+nâ‚—*sâ‚–) + Î»*Î´â‚–â‚—*Î¼Ì„ *Î¼*sign(Ï„)*(náµ¢*sâ±¼+nâ±¼*sáµ¢)+2.0*Î¼*Î»*Î¼Ì„ ^2.0*Î´áµ¢â±¼*náµ¢*nâ±¼ + Î¼*Î»*sign(Ï„)*Î¼Ì„ *Î´áµ¢â±¼*(nâ‚–*sâ‚—+nâ‚—*sâ‚–) + 2.0*Î¼^2.0*sign(Ï„)*Î¼Ì„ *(nâ‚–*sâ‚—+nâ‚—*sâ‚–)*náµ¢*nâ±¼ + 2.0*Î¼*Î¼Ì„ ^2.0*Î»*Î´áµ¢â±¼*nâ‚–*nâ‚— + 2.0*Î¼^2.0*sign(Ï„)*Î¼Ì„ *nâ‚–*nâ‚—*(náµ¢*sâ±¼+nâ±¼*sáµ¢))   

                  Cáµ—â‚â‚â‚â‚ = Cáµ¢áµ¢áµ¢áµ¢ - (1-v^2+Î·)*(4.0*Î¼^2*Î¼Ì„ ^2*nâ‚^4 + Î»^2*Î¼Ì„ ^2 + 4.0*sign(Ï„)^2.0*Î¼^2.0*(nâ‚*sâ‚)^2 + 4.0*Î»*Î¼Ì„ *Î¼*sign(Ï„)*nâ‚*sâ‚ + 4.0*Î¼*Î»*Î¼Ì„ ^2*nâ‚^2 + 8.0*Î¼^2*sign(Ï„)*Î¼Ì„ *nâ‚*sâ‚*nâ‚^2)/âˆ‚fCâˆ‚f
                  Cáµ—â‚‚â‚‚â‚‚â‚‚ = Cáµ¢áµ¢áµ¢áµ¢ - (1-v^2+Î·)*(4.0*Î¼^2*Î¼Ì„ ^2*nâ‚‚^4 + Î»^2*Î¼Ì„ ^2 + 4.0*sign(Ï„)^2.0*Î¼^2.0*(nâ‚‚*sâ‚‚)^2 + 4.0*Î»*Î¼Ì„ *Î¼*sign(Ï„)*nâ‚‚*sâ‚‚ + 4.0*Î¼*Î»*Î¼Ì„ ^2*nâ‚‚^2 + 8.0*Î¼^2*sign(Ï„)*Î¼Ì„ *nâ‚‚*sâ‚‚*nâ‚‚^2)/âˆ‚fCâˆ‚f
                  Cáµ—â‚â‚â‚‚â‚‚ = Cáµ¢áµ¢â±¼â±¼ - (1-v^2+Î·)*(4.0*Î¼^2.0*Î¼Ì„ ^2.0*nâ‚^2*nâ‚‚^2 + Î»^2*Î¼Ì„ ^2 + 4.0*sign(Ï„)^2.0*Î¼^2.0*nâ‚*sâ‚*nâ‚‚*sâ‚‚ + 2.0*Î»*Î¼Ì„ *Î¼*sign(Ï„)*nâ‚*sâ‚ +  4.0*Î¼*Î»*Î¼Ì„ ^2*nâ‚^2 + 4.0*Î¼^2.0*sign(Ï„)*Î¼Ì„ *(nâ‚‚*sâ‚‚)*nâ‚^2 +2.0*Î»*Î¼Ì„ *Î¼*sign(Ï„)*nâ‚‚*sâ‚‚ + 4.0*Î¼*Î»*Î¼Ì„ ^2*nâ‚‚^2 + 4.0*Î¼^2.0*sign(Ï„)*Î¼Ì„ *(nâ‚*sâ‚)*nâ‚‚^2)/âˆ‚fCâˆ‚f
                  Cáµ—â‚‚â‚‚â‚â‚ = Cáµ¢áµ¢â±¼â±¼ - (1-v^2+Î·)*(4.0*Î¼^2.0*Î¼Ì„ ^2.0*nâ‚^2*nâ‚‚^2 + Î»^2*Î¼Ì„ ^2 + 4.0*sign(Ï„)^2.0*Î¼^2.0*nâ‚*sâ‚*nâ‚‚*sâ‚‚ + 2.0*Î»*Î¼Ì„ *Î¼*sign(Ï„)*nâ‚*sâ‚ +  4.0*Î¼*Î»*Î¼Ì„ ^2*nâ‚^2 + 4.0*Î¼^2.0*sign(Ï„)*Î¼Ì„ *(nâ‚‚*sâ‚‚)*nâ‚^2 +2.0*Î»*Î¼Ì„ *Î¼*sign(Ï„)*nâ‚‚*sâ‚‚ + 4.0*Î¼*Î»*Î¼Ì„ ^2*nâ‚‚^2 + 4.0*Î¼^2.0*sign(Ï„)*Î¼Ì„ *(nâ‚*sâ‚)*nâ‚‚^2)/âˆ‚fCâˆ‚f
                  Cáµ—â‚â‚‚â‚â‚‚ = Cáµ¢â±¼áµ¢â±¼ - (1-v^2+Î·)*(4.0*Î¼^2.0*Î¼Ì„ ^2.0*nâ‚^2*nâ‚‚^2 + sign(Ï„)^2.0*Î¼^2.0*(nâ‚*sâ‚‚+nâ‚‚*sâ‚)^2 + 4.0*Î¼^2.0*sign(Ï„)*Î¼Ì„ *(nâ‚*sâ‚‚+nâ‚‚*sâ‚)*nâ‚*nâ‚‚)/âˆ‚fCâˆ‚f
                  Cáµ—â‚â‚â‚â‚‚ = 0.0   - (1-v^2+Î·)*(4.0*Î¼^2.0*Î¼Ì„ ^2.0*nâ‚‚*nâ‚^3 + 2.0*sign(Ï„)^2*Î¼^2*(nâ‚*sâ‚)*(nâ‚*sâ‚‚+nâ‚‚*sâ‚) + 2.0*Î»*Î¼Ì„ *Î¼*sign(Ï„)*(nâ‚*sâ‚‚+nâ‚‚*sâ‚) + 4.0*Î¼*Î»*Î¼Ì„ ^2*nâ‚*nâ‚‚+ 4.0*Î¼^2.0*sign(Ï„)*Î¼Ì„ *nâ‚*sâ‚*nâ‚*nâ‚‚+ 4.0*Î¼^2.0*sign(Ï„)*Î¼Ì„ *nâ‚*sâ‚‚*nâ‚*nâ‚)/âˆ‚fCâˆ‚f
                  Cáµ—â‚â‚‚â‚â‚ = 0.0   - (1-v^2+Î·)*(4.0*Î¼^2.0*Î¼Ì„ ^2.0*nâ‚‚*nâ‚^3 + 2.0*sign(Ï„)^2*Î¼^2*(nâ‚*sâ‚)*(nâ‚*sâ‚‚+nâ‚‚*sâ‚) + 2.0*Î»*Î¼Ì„ *Î¼*sign(Ï„)*(nâ‚*sâ‚‚+nâ‚‚*sâ‚) + 4.0*Î¼*Î»*Î¼Ì„ ^2*nâ‚*nâ‚‚+ 4.0*Î¼^2.0*sign(Ï„)*Î¼Ì„ *nâ‚*sâ‚*nâ‚*nâ‚‚+ 4.0*Î¼^2.0*sign(Ï„)*Î¼Ì„ *nâ‚*sâ‚‚*nâ‚*nâ‚)/âˆ‚fCâˆ‚f
                  Cáµ—â‚‚â‚‚â‚â‚‚ = 0.0   - (1-v^2+Î·)*(4.0*Î¼^2.0*Î¼Ì„ ^2.0*nâ‚*nâ‚‚^3 + 2.0*sign(Ï„)^2*Î¼^2*(nâ‚‚*sâ‚‚)*(nâ‚‚*sâ‚+nâ‚*sâ‚‚) + 2.0*Î»*Î¼Ì„ *Î¼*sign(Ï„)*(nâ‚‚*sâ‚+nâ‚*sâ‚‚) + 4.0*Î¼*Î»*Î¼Ì„ ^2*nâ‚‚*nâ‚+ 4.0*Î¼^2.0*sign(Ï„)*Î¼Ì„ *nâ‚‚*sâ‚‚*nâ‚‚*nâ‚+ 4.0*Î¼^2.0*sign(Ï„)*Î¼Ì„ *nâ‚‚*sâ‚*nâ‚‚*nâ‚‚)/âˆ‚fCâˆ‚f
                  Cáµ—â‚â‚‚â‚‚â‚‚ = 0.0   - (1-v^2+Î·)*(4.0*Î¼^2.0*Î¼Ì„ ^2.0*nâ‚*nâ‚‚^3 + 2.0*sign(Ï„)^2*Î¼^2*(nâ‚‚*sâ‚‚)*(nâ‚‚*sâ‚+nâ‚*sâ‚‚) + 2.0*Î»*Î¼Ì„ *Î¼*sign(Ï„)*(nâ‚‚*sâ‚+nâ‚*sâ‚‚) + 4.0*Î¼*Î»*Î¼Ì„ ^2*nâ‚‚*nâ‚+ 4.0*Î¼^2.0*sign(Ï„)*Î¼Ì„ *nâ‚‚*sâ‚‚*nâ‚‚*nâ‚+ 4.0*Î¼^2.0*sign(Ï„)*Î¼Ì„ *nâ‚‚*sâ‚*nâ‚‚*nâ‚‚)/âˆ‚fCâˆ‚f
               end  
            end    
        end   

       for (i,xáµ¢) in enumerate(ğ“’)
           I = xáµ¢.ğ¼
           for (j,xâ±¼) in enumerate(ğ“’)
             J = xâ±¼.ğ¼
             k[2*I-1,2*J-1] += (Cáµ—â‚â‚â‚â‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚â‚â‚‚*Bâ‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚‚â‚â‚*Bâ‚‚[i]*Bâ‚[j])*ğ‘¤
             k[2*I-1,2*J]   += (Cáµ—â‚â‚â‚‚â‚‚*Bâ‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚[j] + Cáµ—â‚â‚â‚â‚‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚â‚‚â‚‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j])*ğ‘¤
             k[2*I,2*J-1]   += (Cáµ—â‚‚â‚‚â‚â‚*Bâ‚‚[i]*Bâ‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚‚â‚â‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j])*ğ‘¤
             k[2*I,2*J]     += (Cáµ—â‚‚â‚‚â‚‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚â‚‚â‚‚â‚‚*Bâ‚[i]*Bâ‚‚[j] + Cáµ—â‚‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚[j])*ğ‘¤
           end
           fint[2*I-1] += (Bâ‚[i]*Î¾.Ïƒâ‚â‚ + Bâ‚‚[i]*Î¾.Ïƒâ‚â‚‚)*ğ‘¤
           fint[2*I]   += (Bâ‚[i]*Î¾.Ïƒâ‚â‚‚ + Bâ‚‚[i]*Î¾.Ïƒâ‚‚â‚‚)*ğ‘¤
       end   
    end
end 

"""
mc_phasefield
"""
function (op::Operator{:âˆ«váµ¢ÏƒdÎ©_mc_phasefield})(ap::T;k::AbstractMatrix{Float64},fint::AbstractVector{Float64}) where T<:AbstractElement
    ğ“’ = ap.ğ“’; ğ“– = ap.ğ“–
    Î· = op.Î·
    tol = op.tol
    E = op.E
    Î½ = op.Î½
    Î» = E*Î½/(1.0+Î½)/(1.0-2.0*Î½)
    Î¼ = 0.5*E/(1.0+Î½)
    c = 10
    ğœ™ = Ï€/3.0
    tol = op.tol 
    Î· = op.Î·
    Cáµ¢áµ¢áµ¢áµ¢ = E/(1-Î½^2)
    Cáµ¢áµ¢â±¼â±¼ = E*Î½/(1-Î½^2)
    Cáµ¢â±¼áµ¢â±¼ = E/2/(1+Î½)
    
    for  Î¾ in ğ“–
        N = Î¾[:ğ­]
        Bâ‚ = Î¾[:âˆ‚ğ­âˆ‚x]
        Bâ‚‚ = Î¾[:âˆ‚ğ­âˆ‚y]
        Ïƒâ‚â‚ = Î¾.Ïƒâ‚â‚
        Ïƒâ‚‚â‚‚ = Î¾.Ïƒâ‚‚â‚‚
        Ïƒâ‚â‚‚ = Î¾.Ïƒâ‚â‚‚
        Îµáµ–â‚â‚ = Î¾.Îµáµ–â‚â‚
        Îµáµ–â‚‚â‚‚ = Î¾.Îµáµ–â‚‚â‚‚
        Îµáµ–â‚â‚‚ = Î¾.Îµáµ–â‚â‚‚
        ğ‘¤ = Î¾.ğ‘¤
        Î”Îµâ‚â‚ = 0.0
        Î”Îµâ‚‚â‚‚ = 0.0
        Î”Îµâ‚â‚‚ = 0.0
        Îµâ‚â‚ = 0.0
        Îµâ‚‚â‚‚ = 0.0
        Îµâ‚â‚‚ = 0.0
        âˆ‚vâˆ‚x = 0.0
        âˆ‚vâˆ‚y = 0.0
        v    = 0.0
        for (i,xáµ¢) in enumerate(ğ“’)
            Îµâ‚â‚ += Bâ‚[i]*xáµ¢.dâ‚
            Îµâ‚‚â‚‚ += Bâ‚‚[i]*xáµ¢.dâ‚‚
            Îµâ‚â‚‚ += Bâ‚[i]*xáµ¢.dâ‚‚ + Bâ‚‚[i]*xáµ¢.dâ‚
            Î”Îµâ‚â‚ += Bâ‚[i]*xáµ¢.Î”dâ‚
            Î”Îµâ‚‚â‚‚ += Bâ‚‚[i]*xáµ¢.Î”dâ‚‚
            Î”Îµâ‚â‚‚ += Bâ‚[i]*xáµ¢.Î”dâ‚‚ + Bâ‚‚[i]*xáµ¢.Î”dâ‚
            v += N[i]*xáµ¢.v
            âˆ‚vâˆ‚x += Bâ‚[i]*xáµ¢.v
            âˆ‚vâˆ‚y += Bâ‚‚[i]*xáµ¢.v
        end 
        normâˆ‡v = (âˆ‚vâˆ‚x^2+âˆ‚vâˆ‚y^2)^0.5#n = âˆ‡v/norm(âˆ‡v)
        nâ‚ = (âˆ‚vâˆ‚x)/(normâˆ‡v)
        nâ‚‚ = (âˆ‚vâˆ‚y)/(normâˆ‡v)


        # predict phase
        Îµâ‚™ = Îµâ‚â‚*nâ‚*nâ‚ + Îµâ‚‚â‚‚*nâ‚‚*nâ‚‚ + Îµâ‚â‚‚*nâ‚*nâ‚‚

        Ïƒâ‚â‚áµ—Ê³ = Ïƒâ‚â‚ + Cáµ¢áµ¢áµ¢áµ¢*Î”Îµâ‚â‚ + Cáµ¢áµ¢â±¼â±¼*Î”Îµâ‚‚â‚‚
        Ïƒâ‚‚â‚‚áµ—Ê³ = Ïƒâ‚‚â‚‚ + Cáµ¢áµ¢áµ¢áµ¢*Î”Îµâ‚‚â‚‚ + Cáµ¢áµ¢â±¼â±¼*Î”Îµâ‚â‚
        Ïƒâ‚â‚‚áµ—Ê³ = Ïƒâ‚â‚‚ + Cáµ¢â±¼áµ¢â±¼*Î”Îµâ‚â‚‚

        Ïƒâ‚,Ïƒâ‚‚,nâ‚,nâ‚‚ = getÏƒâ‚™(Ïƒâ‚â‚áµ—Ê³,Ïƒâ‚‚â‚‚áµ—Ê³,Ïƒâ‚â‚‚áµ—Ê³)
        fáµ—Ê³ = Ïƒâ‚-Ïƒâ‚‚ + (Ïƒâ‚+Ïƒâ‚‚) * sin(ğœ™) - 2.0*c*cos(ğœ™)


 
        #if fáµ—Ê³ > tol
        #    
        #  error("fáµ—Ê³ > tol!")
        #end
        if (1-v) < tol 
            Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³
            Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³
            Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³
            Cáµ—â‚â‚â‚â‚ = Cáµ¢áµ¢áµ¢áµ¢ 
            Cáµ—â‚‚â‚‚â‚‚â‚‚ = Cáµ¢áµ¢áµ¢áµ¢ 
            Cáµ—â‚â‚â‚‚â‚‚ = Cáµ¢áµ¢â±¼â±¼  
            Cáµ—â‚â‚‚â‚â‚‚ = Cáµ¢â±¼áµ¢â±¼ 
            Cáµ—â‚â‚â‚â‚‚ = 0.0
            Cáµ—â‚‚â‚‚â‚â‚‚ = 0.0
        else   
            if Îµâ‚™ > 0.0
               Ïƒâ‚â‚áµ—Ê³ = Ïƒâ‚â‚ + (v^2+Î·)*(Cáµ¢áµ¢áµ¢áµ¢*Î”Îµâ‚â‚ + Cáµ¢áµ¢â±¼â±¼*Î”Îµâ‚‚â‚‚)
               Ïƒâ‚‚â‚‚áµ—Ê³ = Ïƒâ‚‚â‚‚ + (v^2+Î·)*(Cáµ¢áµ¢áµ¢áµ¢*Î”Îµâ‚‚â‚‚ + Cáµ¢áµ¢â±¼â±¼*Î”Îµâ‚â‚)
               Ïƒâ‚â‚‚áµ—Ê³ = Ïƒâ‚â‚‚ + (v^2+Î·)*Cáµ¢â±¼áµ¢â±¼*Î”Îµâ‚â‚‚
               Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³
               Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³
               Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³
               Cáµ—â‚â‚â‚â‚ = (v^2+Î·)*Cáµ¢áµ¢áµ¢áµ¢
               Cáµ—â‚‚â‚‚â‚‚â‚‚ = (v^2+Î·)*Cáµ¢áµ¢áµ¢áµ¢
               Cáµ—â‚â‚â‚‚â‚‚ = (v^2+Î·)*Cáµ¢áµ¢â±¼â±¼ 
               Cáµ—â‚â‚‚â‚â‚‚ = (v^2+Î·)*Cáµ¢â±¼áµ¢â±¼ 
               Cáµ—â‚â‚â‚â‚‚ = 0.0
               Cáµ—â‚‚â‚‚â‚â‚‚ = 0.0
            else
                if fáµ—Ê³ > tol
                    sinğœ™ = sin(ğœ™)
                    sinÂ²ğœ™ = sin(ğœ™)*sin(ğœ™)
                    sinÂ²ğœ™psinğœ™ = sinÂ²ğœ™ +sin(ğœ™) 
                    sinÂ²ğœ™dsinğœ™ = sinÂ²ğœ™ -sin(ğœ™) 
                    âˆ‚fCâˆ‚f=(4.0*sinÂ²ğœ™*Î»+4.0*(1.0+sinÂ²ğœ™)*Î¼)
                    Î”Î³ = fáµ—Ê³/âˆ‚fCâˆ‚f
                   
                    Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³ - (1-v^2+Î·)*Î”Î³*(2*sinğœ™*Î»+2*((sinğœ™+1)*nâ‚[1]*nâ‚[1]+(sinğœ™-1)*nâ‚‚[1]*nâ‚‚[1])*Î¼)#ä¸Šæ ‡1å¯¹åº”ä¹‹å‰ä¸‹æ ‡1
                    Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³ - (1-v^2+Î·)*Î”Î³*(2*sinğœ™*Î»+2*((sinğœ™+1)*nâ‚[2]*nâ‚[2]+(sinğœ™-1)*nâ‚‚[2]*nâ‚‚[2])*Î¼)
                    Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³ - (1-v^2+Î·)*Î”Î³*2*((sinğœ™+1)*nâ‚[1]*nâ‚[2]+(sinğœ™-1)*nâ‚‚[1]*nâ‚‚[2])*Î¼
                    Î¾.Îµáµ–â‚â‚ = Îµáµ–â‚â‚ + (1-v^2+Î·)*Î”Î³*((sinğœ™+1)*nâ‚[1]*nâ‚[1]+(sinğœ™-1)nâ‚‚[1]*nâ‚‚[1])
                    Î¾.Îµáµ–â‚‚â‚‚ = Îµáµ–â‚‚â‚‚ + (1-v^2+Î·)*Î”Î³*((sinğœ™+1)*nâ‚[2]*nâ‚[2]+(sinğœ™-1)nâ‚‚[2]*nâ‚‚[2])
                    Î¾.Îµáµ–â‚â‚‚ = Îµáµ–â‚â‚‚ + (1-v^2+Î·)*Î”Î³*(((sinğœ™+1)*nâ‚[1]*nâ‚[2]+(sinğœ™-1)nâ‚‚[1]*nâ‚‚[2]))
    
                    Cáµ—â‚â‚â‚â‚=Cáµ¢áµ¢áµ¢áµ¢-(1-v^2+Î·)*(4.0*sinÂ²ğœ™*Î»^2 + 8.0*sinÂ²ğœ™psinğœ™*Î»*Î¼*(nâ‚[1])^2 + 8.0*(sinÂ²ğœ™dsinğœ™)*Î»*Î¼*(nâ‚‚[1])^2-8.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚[1]^2*nâ‚‚[1]^2+4.0*(sinğœ™+1)^2*Î¼^2*(nâ‚[1])^4+4.0*(sinğœ™-1)^2*Î¼^2*(nâ‚‚[1])^4)/âˆ‚fCâˆ‚f
                    Cáµ—â‚‚â‚‚â‚‚â‚‚=Cáµ¢áµ¢áµ¢áµ¢-(1-v^2+Î·)*(4.0*sinÂ²ğœ™*Î»^2 + 8.0*sinÂ²ğœ™psinğœ™*Î»*Î¼*(nâ‚[2])^2 + 8.0*(sinÂ²ğœ™dsinğœ™)*Î»*Î¼*(nâ‚‚[2])^2-8.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚[2]^2*nâ‚‚[2]^2+4.0*(sinğœ™+1)^2*Î¼^2*(nâ‚[2])^4+4.0*(sinğœ™-1)^2*Î¼^2*(nâ‚‚[2])^4)/âˆ‚fCâˆ‚f
                    Cáµ—â‚â‚â‚‚â‚‚=Cáµ¢áµ¢â±¼â±¼-(1-v^2+Î·)*(4.0*sinÂ²ğœ™*Î»^2 + 4.0*sinÂ²ğœ™psinğœ™*Î»*Î¼*((nâ‚[1])^2+(nâ‚[2])^2)+4.0*(sinÂ²ğœ™dsinğœ™)*Î»*Î¼*((nâ‚‚[1])^2+(nâ‚‚[2])^2)+4.0*(sinğœ™+1)^2*Î¼^2*(nâ‚[1])^2*(nâ‚[2])^2-4.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*((nâ‚‚[1])^2*(nâ‚[2])^2+(nâ‚[1])^2*(nâ‚‚[2])^2)+4.0*(sinğœ™-1)^2*Î¼^2*(nâ‚‚[1])^2*(nâ‚‚[2])^2)/âˆ‚fCâˆ‚f
                    Cáµ—â‚â‚‚â‚â‚‚=Cáµ¢â±¼áµ¢â±¼-2.0*(1-v^2+Î·)*(-8.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚[1]*nâ‚[2]*nâ‚‚[1]*nâ‚‚[2]+4.0*(sinğœ™+1)^2*Î¼^2*(nâ‚[1]*nâ‚[2])^2+4.0*(sinğœ™-1)^2*Î¼^2*(nâ‚‚[1]*nâ‚‚[2])^2)/âˆ‚fCâˆ‚f
                    Cáµ—â‚â‚â‚â‚‚ = - (1-v^2+Î·)*(4.0*sinÂ²ğœ™psinğœ™*Î»*Î¼*nâ‚[1]*nâ‚[2] + 4.0*(sinÂ²ğœ™dsinğœ™)*Î»*Î¼*nâ‚‚[1]*nâ‚‚[2]-4.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚‚[1]^2*nâ‚[1]*nâ‚[2]-4.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚[1]^2*nâ‚‚[1]*nâ‚‚[2]+4.0*(sinğœ™+1)^2*Î¼^2*(nâ‚[1])^3*nâ‚[2]+4.0*(sinğœ™-1)^2*Î¼^2*(nâ‚‚[1])^3*nâ‚‚[2])/âˆ‚fCâˆ‚f
                    Cáµ—â‚‚â‚‚â‚â‚‚ = - (1-v^2+Î·)*(4.0*sinÂ²ğœ™psinğœ™*Î»*Î¼*nâ‚[2]*nâ‚[1] + 4.0*(sinÂ²ğœ™dsinğœ™)*Î»*Î¼*nâ‚‚[2]*nâ‚‚[1]-4.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚‚[2]^2*nâ‚[2]*nâ‚[1]-4.0*cos(ğœ™)*cos(ğœ™)*Î¼^2*nâ‚[2]^2*nâ‚‚[2]*nâ‚‚[1]+4.0*(sinğœ™+1)^2*Î¼^2*(nâ‚[2])^3*nâ‚[1]+4.0*(sinğœ™-1)^2*Î¼^2*(nâ‚‚[2])^3*nâ‚‚[1])/âˆ‚fCâˆ‚f
                else
                    Î¾.Ïƒâ‚â‚ = Ïƒâ‚â‚áµ—Ê³
                    Î¾.Ïƒâ‚‚â‚‚ = Ïƒâ‚‚â‚‚áµ—Ê³
                    Î¾.Ïƒâ‚â‚‚ = Ïƒâ‚â‚‚áµ—Ê³
                    Cáµ—â‚â‚â‚â‚ = Cáµ¢áµ¢áµ¢áµ¢
                    Cáµ—â‚‚â‚‚â‚‚â‚‚ = Cáµ¢áµ¢áµ¢áµ¢
                    Cáµ—â‚â‚â‚‚â‚‚ = Cáµ¢áµ¢â±¼â±¼
                    Cáµ—â‚â‚‚â‚â‚‚ = Cáµ¢â±¼áµ¢â±¼
                    Cáµ—â‚â‚â‚â‚‚ = 0.0
                    Cáµ—â‚‚â‚‚â‚â‚‚ = 0.0
                end             
            end
        end    
        for (i,xáµ¢) in enumerate(ğ“’)
            I = xáµ¢.ğ¼
            for (j,xâ±¼) in enumerate(ğ“’)
                J = xâ±¼.ğ¼
                k[2*I-1,2*J-1] += (Cáµ—â‚â‚â‚â‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚â‚â‚‚*(Bâ‚[i]*Bâ‚‚[j]+Bâ‚‚[i]*Bâ‚[j]))*ğ‘¤
                k[2*I-1,2*J]   += (Cáµ—â‚â‚â‚‚â‚‚*Bâ‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚[j] + Cáµ—â‚â‚â‚â‚‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j])*ğ‘¤
                k[2*I,2*J-1]   += (Cáµ—â‚â‚â‚‚â‚‚*Bâ‚‚[i]*Bâ‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚â‚â‚‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚‚â‚‚â‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j])*ğ‘¤
                k[2*I,2*J]     += (Cáµ—â‚‚â‚‚â‚‚â‚‚*Bâ‚‚[i]*Bâ‚‚[j] + Cáµ—â‚â‚‚â‚â‚‚*Bâ‚[i]*Bâ‚[j] + Cáµ—â‚‚â‚‚â‚â‚‚*(Bâ‚[i]*Bâ‚‚[j]+Bâ‚‚[i]*Bâ‚[j]))*ğ‘¤
     
            end
            fint[2*I-1] += Bâ‚[i]*Î¾.Ïƒâ‚â‚*ğ‘¤ + Bâ‚‚[i]*Î¾.Ïƒâ‚â‚‚*ğ‘¤
            fint[2*I]   += Bâ‚[i]*Î¾.Ïƒâ‚â‚‚*ğ‘¤ + Bâ‚‚[i]*Î¾.Ïƒâ‚‚â‚‚*ğ‘¤
    
        end
    end
end    
