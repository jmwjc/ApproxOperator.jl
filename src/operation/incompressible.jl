
function (op::Operator{:âˆ«âˆ«qpdxdy})(ap::T;k::AbstractMatrix{Float64}) where T<:AbstractElement
    ð“’ = ap.ð“’; ð“– = ap.ð“–
    E = op.E
    Î½ = op.Î½
    K = E/3/(1-2*Î½)
    for Î¾ in ð“–
        ð‘¤ = Î¾.ð‘¤
        N = Î¾[:ð­]
        for (i,xáµ¢) in enumerate(ð“’)
            I = xáµ¢.ð¼
            for (j,xâ±¼) in enumerate(ð“’)
                J = xâ±¼.ð¼
                k[I,J] -= N[i]*N[j]/K*ð‘¤
            end
        end
    end
end

function (op::Operator{:âˆ«âˆ«qpdxdy})(aâ‚š::T,aâ‚›::S;k::AbstractMatrix{Float64}) where {T<:AbstractElement,S<:AbstractElement}
    ð“’â‚š = aâ‚š.ð“’
    ð“’â‚› = aâ‚›.ð“’
    ð“–â‚š = aâ‚š.ð“–
    ð“–â‚› = aâ‚›.ð“–
    E = op.E
    Î½ = op.Î½
    K = E/3/(1-2*Î½)
    for (Î¾â‚š,Î¾â‚›) in zip(ð“–â‚š,ð“–â‚›)
        ð‘¤ = Î¾â‚š.ð‘¤
        Nâ‚š = Î¾â‚š[:ð­]
        Nâ‚› = Î¾â‚›[:ð­]
        for (i,xáµ¢) in enumerate(ð“’â‚›)
            I = xáµ¢.ð¼
            for (j,xâ±¼) in enumerate(ð“’â‚š)
                J = xâ±¼.ð¼
                k[I,J] -= N[i]*N[j]/K*ð‘¤
            end
        end
    end
end

function (op::Operator{:âˆ«âˆ«pâˆ‡vdxdy})(aáµ¤::T,aâ‚š::S;k::AbstractMatrix{Float64}) where {T<:AbstractElement,S<:AbstractElement}
    ð“’áµ¤ = aáµ¤.ð“’
    ð“’â‚š = aâ‚š.ð“’
    ð“–áµ¤ = aáµ¤.ð“–
    ð“–â‚š = aâ‚š.ð“–
    for (Î¾áµ¤,Î¾â‚š) in zip(ð“–áµ¤,ð“–â‚š)
        N = Î¾â‚š[:ð­]
        Bâ‚ = Î¾áµ¤[:âˆ‚ð­âˆ‚x]
        Bâ‚‚ = Î¾áµ¤[:âˆ‚ð­âˆ‚y]
        ð‘¤ = Î¾áµ¤.ð‘¤
        for (i,xáµ¢) in enumerate(ð“’â‚š)
            I = xáµ¢.ð¼
            for (j,xâ±¼) in enumerate(ð“’áµ¤)
                J = xâ±¼.ð¼
                k[I,2*J-1] += N[i]*Bâ‚[j]*ð‘¤
                k[I,2*J]   += N[i]*Bâ‚‚[j]*ð‘¤
            end
        end
    end
end

function (op::Operator{:âˆ«pnáµ¢gáµ¢ds})(aáµ¤::T,aâ‚š::S;k::AbstractMatrix{Float64},f::AbstractVector{Float64}) where {T<:AbstractElement,S<:AbstractElement}
    ð“’áµ¤ = aáµ¤.ð“’
    ð“’â‚š = aâ‚š.ð“’
    ð“–áµ¤ = aáµ¤.ð“–
    ð“–â‚š = aâ‚š.ð“–
    for (Î¾áµ¤,Î¾â‚š) in zip(ð“–áµ¤,ð“–â‚š)
        Nâ‚š = Î¾â‚š[:ð­]
        Náµ¤ = Î¾áµ¤[:ð­]
        nâ‚ = Î¾áµ¤.nâ‚
        nâ‚‚ = Î¾áµ¤.nâ‚‚
        gâ‚ = Î¾áµ¤.gâ‚
        gâ‚‚ = Î¾áµ¤.gâ‚‚
        nâ‚â‚ = Î¾áµ¤.nâ‚â‚
        nâ‚â‚‚ = Î¾áµ¤.nâ‚â‚‚
        nâ‚‚â‚‚ = Î¾áµ¤.nâ‚‚â‚‚
        ð‘¤ = Î¾áµ¤.ð‘¤
        for (i,xáµ¢) in enumerate(ð“’â‚š)
            I = xáµ¢.ð¼
            for (j,xâ±¼) in enumerate(ð“’áµ¤)
                J = xâ±¼.ð¼
                k[I,2*J-1] -= Nâ‚š[i]*Náµ¤[j]*(nâ‚*nâ‚â‚+nâ‚‚*nâ‚â‚‚)*ð‘¤
                k[I,2*J]   -= Nâ‚š[i]*Náµ¤[j]*(nâ‚*nâ‚â‚‚+nâ‚‚*nâ‚‚â‚‚)*ð‘¤
            end
            f[I] -= Nâ‚š[i]*(nâ‚*nâ‚â‚*gâ‚+nâ‚*nâ‚â‚‚*gâ‚‚+nâ‚‚*nâ‚â‚‚*gâ‚+nâ‚‚*nâ‚‚â‚‚*gâ‚‚)*ð‘¤
        end
    end
end

function (op::Operator{:âˆ«âˆ«Î´sáµ¢â±¼sáµ¢â±¼dxdy})(ap::T;k::AbstractMatrix{Float64}) where T<:AbstractElement
    ð“’ = ap.ð“’; ð“– = ap.ð“–
    E = op.E
    Î½ = op.Î½
    G = E/(1+Î½)
    for Î¾ in ð“–
        ð‘¤ = Î¾.ð‘¤
        N = Î¾[:ð­]
        for (i,xáµ¢) in enumerate(ð“’)
            I = xáµ¢.ð¼
            for (j,xâ±¼) in enumerate(ð“’)
                J = xâ±¼.ð¼
                k[4*I-3,4*J-3] -= 4/9/G*N[i]*N[j]*ð‘¤
                k[4*I-3,4*J-2] += 1/3/G*N[i]*N[j]*ð‘¤
                k[4*I-3,4*J-1] += 1/3/G*N[i]*N[j]*ð‘¤
                k[4*I-2,4*J-3] += 1/3/G*N[i]*N[j]*ð‘¤
                k[4*I-2,4*J-2] -= 2/3/G*N[i]*N[j]*ð‘¤
                k[4*I-2,4*J-1] += 1/3/G*N[i]*N[j]*ð‘¤
                k[4*I-1,4*J-3] += 1/3/G*N[i]*N[j]*ð‘¤
                k[4*I-1,4*J-2] += 1/3/G*N[i]*N[j]*ð‘¤
                k[4*I-1,4*J-1] -= 2/3/G*N[i]*N[j]*ð‘¤
                k[4*I,4*J]     -=   2/G*N[i]*N[j]*ð‘¤

                # k[3*I-2,3*J-2] -= N[i]*N[j]/G*ð‘¤
                # k[3*I-1,3*J-1] -= N[i]*N[j]/G*ð‘¤
                # k[3*I,3*J]     -= 2*N[i]*N[j]/G*ð‘¤
            end
        end
    end
end

function (op::Operator{:âˆ«âˆ«sáµ¢â±¼Îµáµ¢â±¼dxdy})(aáµ¤::T,aâ‚›::S;k::AbstractMatrix{Float64}) where {T<:AbstractElement,S<:AbstractElement}
    ð“’áµ¤ = aáµ¤.ð“’
    ð“’â‚› = aâ‚›.ð“’
    ð“–áµ¤ = aáµ¤.ð“–
    ð“–â‚› = aâ‚›.ð“–
    for (Î¾áµ¤,Î¾â‚›) in zip(ð“–áµ¤,ð“–â‚›)
        N = Î¾â‚›[:ð­]
        Bâ‚ = Î¾áµ¤[:âˆ‚ð­âˆ‚x]
        Bâ‚‚ = Î¾áµ¤[:âˆ‚ð­âˆ‚y]
        ð‘¤ = Î¾áµ¤.ð‘¤
        for (i,xáµ¢) in enumerate(ð“’â‚›)
            I = xáµ¢.ð¼
            for (j,xâ±¼) in enumerate(ð“’áµ¤)
                J = xâ±¼.ð¼
                k[4*I-3,2*J-1] += 2/3*N[i]*Bâ‚[j]*ð‘¤
                k[4*I-3,2*J]   -= 1/3*N[i]*Bâ‚‚[j]*ð‘¤
                k[4*I-2,2*J-1] -= 1/3*N[i]*Bâ‚[j]*ð‘¤
                k[4*I-2,2*J]   += 2/3*N[i]*Bâ‚‚[j]*ð‘¤
                k[4*I-1,2*J-1] -= 1/3*N[i]*Bâ‚[j]*ð‘¤
                k[4*I-1,2*J]   -= 1/3*N[i]*Bâ‚‚[j]*ð‘¤
                k[4*I,2*J-1]   +=     N[i]*Bâ‚‚[j]*ð‘¤
                k[4*I,2*J]     +=     N[i]*Bâ‚[j]*ð‘¤

                # k[3*I-2,2*J-1] += 2/3*N[i]*Bâ‚[j]*ð‘¤
                # k[3*I-2,2*J]   -= 1/3*N[i]*Bâ‚‚[j]*ð‘¤
                # k[3*I-1,2*J-1] -= 1/3*N[i]*Bâ‚[j]*ð‘¤
                # k[3*I-1,2*J]   += 2/3*N[i]*Bâ‚‚[j]*ð‘¤
                # k[3*I,2*J-1]   += N[i]*Bâ‚‚[j]*ð‘¤
                # k[3*I,2*J]     += N[i]*Bâ‚[j]*ð‘¤

                # k[3*I-2,2*J-1] += N[i]*Bâ‚[j]*ð‘¤
                # k[3*I-1,2*J]   += N[i]*Bâ‚‚[j]*ð‘¤
                # k[3*I,2*J-1]   += N[i]*Bâ‚‚[j]*ð‘¤
                # k[3*I,2*J]     += N[i]*Bâ‚[j]*ð‘¤
            end
        end
    end
end

function (op::Operator{:âˆ«sáµ¢â±¼nâ±¼gáµ¢ds})(aáµ¤::T,aâ‚›::S;k::AbstractMatrix{Float64},f::AbstractVector{Float64}) where {T<:AbstractElement,S<:AbstractElement}
    ð“’áµ¤ = aáµ¤.ð“’
    ð“’â‚› = aâ‚›.ð“’
    ð“–áµ¤ = aáµ¤.ð“–
    ð“–â‚› = aâ‚›.ð“–
    for (Î¾áµ¤,Î¾â‚›) in zip(ð“–áµ¤,ð“–â‚›)
        Nâ‚› = Î¾â‚›[:ð­]
        Náµ¤ = Î¾áµ¤[:ð­]
        nâ‚ = Î¾áµ¤.nâ‚
        nâ‚‚ = Î¾áµ¤.nâ‚‚
        gâ‚ = Î¾áµ¤.gâ‚
        gâ‚‚ = Î¾áµ¤.gâ‚‚
        nâ‚â‚ = Î¾áµ¤.nâ‚â‚
        nâ‚â‚‚ = Î¾áµ¤.nâ‚â‚‚
        nâ‚‚â‚‚ = Î¾áµ¤.nâ‚‚â‚‚
        ð‘¤ = Î¾áµ¤.ð‘¤
        for (i,xáµ¢) in enumerate(ð“’â‚›)
            I = xáµ¢.ð¼
            for (j,xâ±¼) in enumerate(ð“’áµ¤)
                J = xâ±¼.ð¼
                k[4*I-3,2*J-1] -= Nâ‚›[i]*Náµ¤[j]*( 2/3*nâ‚*nâ‚â‚ - 1/3*nâ‚‚*nâ‚â‚‚)*ð‘¤
                k[4*I-3,2*J]   -= Nâ‚›[i]*Náµ¤[j]*( 2/3*nâ‚*nâ‚â‚‚ - 1/3*nâ‚‚*nâ‚‚â‚‚)*ð‘¤
                k[4*I-2,2*J-1] -= Nâ‚›[i]*Náµ¤[j]*(-1/3*nâ‚*nâ‚â‚ + 2/3*nâ‚‚*nâ‚â‚‚)*ð‘¤
                k[4*I-2,2*J]   -= Nâ‚›[i]*Náµ¤[j]*(-1/3*nâ‚*nâ‚â‚‚ + 2/3*nâ‚‚*nâ‚‚â‚‚)*ð‘¤
                k[4*I-1,2*J-1] -= Nâ‚›[i]*Náµ¤[j]*(-1/3*nâ‚*nâ‚â‚ - 1/3*nâ‚‚*nâ‚â‚‚)*ð‘¤
                k[4*I-1,2*J]   -= Nâ‚›[i]*Náµ¤[j]*(-1/3*nâ‚*nâ‚â‚‚ - 1/3*nâ‚‚*nâ‚‚â‚‚)*ð‘¤
                k[4*I,2*J-1]   -= Nâ‚›[i]*Náµ¤[j]*(nâ‚*nâ‚â‚‚ + nâ‚‚*nâ‚â‚)*ð‘¤
                k[4*I,2*J]     -= Nâ‚›[i]*Náµ¤[j]*(nâ‚*nâ‚‚â‚‚ + nâ‚‚*nâ‚â‚‚)*ð‘¤

                # k[3*I-2,2*J-1] -= Nâ‚›[i]*Náµ¤[j]*( 2/3*nâ‚*nâ‚â‚ - 1/3*nâ‚‚*nâ‚â‚‚)*ð‘¤
                # k[3*I-2,2*J]   -= Nâ‚›[i]*Náµ¤[j]*( 2/3*nâ‚*nâ‚â‚‚ - 1/3*nâ‚‚*nâ‚‚â‚‚)*ð‘¤
                # k[3*I-1,2*J-1] -= Nâ‚›[i]*Náµ¤[j]*(-1/3*nâ‚*nâ‚â‚ + 2/3*nâ‚‚*nâ‚â‚‚)*ð‘¤
                # k[3*I-1,2*J]   -= Nâ‚›[i]*Náµ¤[j]*(-1/3*nâ‚*nâ‚â‚‚ + 2/3*nâ‚‚*nâ‚‚â‚‚)*ð‘¤
                # k[3*I,2*J-1]   -= Nâ‚›[i]*Náµ¤[j]*(nâ‚*nâ‚â‚‚+nâ‚‚*nâ‚â‚)*ð‘¤
                # k[3*I,2*J]     -= Nâ‚›[i]*Náµ¤[j]*(nâ‚*nâ‚‚â‚‚+nâ‚‚*nâ‚â‚‚)*ð‘¤
            end
            f[4*I-3] -= Nâ‚›[i]*(( 2/3*nâ‚*nâ‚â‚-1/3*nâ‚‚*nâ‚â‚‚)*gâ‚+( 2/3*nâ‚*nâ‚â‚‚-1/3*nâ‚‚*nâ‚‚â‚‚)*gâ‚‚)*ð‘¤
            f[4*I-2] -= Nâ‚›[i]*((-1/3*nâ‚*nâ‚â‚+2/3*nâ‚‚*nâ‚â‚‚)*gâ‚+(-1/3*nâ‚*nâ‚â‚‚+2/3*nâ‚‚*nâ‚‚â‚‚)*gâ‚‚)*ð‘¤
            f[4*I-1] -= Nâ‚›[i]*((-1/3*nâ‚*nâ‚â‚-1/3*nâ‚‚*nâ‚â‚‚)*gâ‚+(-1/3*nâ‚*nâ‚â‚‚-1/3*nâ‚‚*nâ‚‚â‚‚)*gâ‚‚)*ð‘¤
            f[4*I]   -= Nâ‚›[i]*((nâ‚*nâ‚â‚‚+nâ‚‚*nâ‚â‚)*gâ‚+(nâ‚*nâ‚‚â‚‚+nâ‚‚*nâ‚â‚‚)*gâ‚‚)*ð‘¤

            # f[3*I-2] -= Nâ‚›[i]*((2/3*nâ‚*nâ‚â‚-1/3*nâ‚‚*nâ‚â‚‚)*gâ‚+(2/3*nâ‚*nâ‚â‚‚-1/3*nâ‚‚*nâ‚‚â‚‚)*gâ‚‚)*ð‘¤
            # f[3*I-1] -= Nâ‚›[i]*((-1/3*nâ‚*nâ‚â‚+2/3*nâ‚‚*nâ‚â‚‚)*gâ‚+(-1/3*nâ‚*nâ‚â‚‚+2/3*nâ‚‚*nâ‚‚â‚‚)*gâ‚‚)*ð‘¤
            # f[3*I]   -= Nâ‚›[i]*((nâ‚*nâ‚â‚‚+nâ‚‚*nâ‚â‚)*gâ‚+(nâ‚*nâ‚‚â‚‚+nâ‚‚*nâ‚â‚‚)*gâ‚‚)*ð‘¤
        end
    end
end


