# FIXME: The shape function order is wrong!
function set𝝭!(::Element{:Tri6},x::Node)
    𝝭 = x[:𝝭]
    ξ = 1.0-x.ξ-x.η
    η = x.ξ
    γ = x.η
    𝝭[1] = ξ*(2*ξ-1)
    𝝭[2] = η*(2*η-1)
    𝝭[3] = γ*(2*γ-1)
    𝝭[4] = 4*ξ*η
    𝝭[5] = 4*η*γ
    𝝭[6] = 4*γ*ξ
end

function set∇𝝭!(ap::Element{:Tri6},x::Node)
    𝐽 = x.𝐽
    ξ = 1.0-x.ξ-x.η
    η = x.ξ
    γ = x.η
    x₁ = ap.𝓒[1].x
    x₂ = ap.𝓒[2].x
    x₃ = ap.𝓒[3].x
    y₁ = ap.𝓒[1].y
    y₂ = ap.𝓒[2].y
    y₃ = ap.𝓒[3].y
    J₁₁ = (y₂-y₃)/𝐽
    J₂₁ = (y₃-y₁)/𝐽
    J₃₁ = (y₁-y₂)/𝐽
    J₁₂ = (x₃-x₂)/𝐽
    J₂₂ = (x₁-x₃)/𝐽
    J₃₂ = (x₂-x₁)/𝐽
    𝝭 = x[:𝝭]
    𝝭[1] = ξ*(2*ξ-1)
    𝝭[2] = η*(2*η-1)
    𝝭[3] = γ*(2*γ-1)
    𝝭[4] = 4*ξ*η
    𝝭[5] = 4*η*γ
    𝝭[6] = 4*γ*ξ
    ∂𝝭∂x = x[:∂𝝭∂x]
    ∂𝝭∂y = x[:∂𝝭∂y]
    ∂𝝭∂x[1] = (4.0*ξ-1.0)*J₁₁
    ∂𝝭∂x[2] = (4.0*η-1.0)*J₂₁
    ∂𝝭∂x[3] = (4.0*γ-1.0)*J₃₁
    ∂𝝭∂x[4] = 4.0*(η*J₁₁+ξ*J₂₁)
    ∂𝝭∂x[5] = 4.0*(γ*J₂₁+η*J₃₁)
    ∂𝝭∂x[6] = 4.0*(ξ*J₃₁+γ*J₁₁)
    ∂𝝭∂y[1] = (4.0*ξ-1.0)*J₁₂
    ∂𝝭∂y[2] = (4.0*η-1.0)*J₂₂
    ∂𝝭∂y[3] = (4.0*γ-1.0)*J₃₂
    ∂𝝭∂y[4] = 4.0*(η*J₁₂+ξ*J₂₂)
    ∂𝝭∂y[5] = 4.0*(γ*J₂₂+η*J₃₂)
    ∂𝝭∂y[6] = 4.0*(ξ*J₃₂+γ*J₁₂)
end

function set∇²𝝭!(ap::Element{:Tri6},x::Node)
    𝐽 = x.𝐽
    ξ = 1.0-x.ξ-x.η
    η = x.ξ
    γ = x.η
    x₁ = ap.𝓒[1].x
    x₂ = ap.𝓒[2].x
    x₃ = ap.𝓒[3].x
    y₁ = ap.𝓒[1].y
    y₂ = ap.𝓒[2].y
    y₃ = ap.𝓒[3].y
    J₁₁ = (y₂-y₃)/𝐽
    J₂₁ = (y₃-y₁)/𝐽
    J₃₁ = (y₁-y₂)/𝐽
    J₁₂ = (x₃-x₂)/𝐽
    J₂₂ = (x₁-x₃)/𝐽
    J₃₂ = (x₂-x₁)/𝐽
    J₁₁² = J₁₁ * J₁₁
    J₂₁² = J₂₁ * J₂₁
    J₃₁² = J₃₁ * J₃₁
    J₁₂² = J₁₂ * J₁₂
    J₂₂² = J₂₂ * J₂₂
    J₃₂² = J₃₂ * J₃₂
    𝝭 = x[:𝝭]
    𝝭[1] = ξ*(2*ξ-1)
    𝝭[2] = η*(2*η-1)
    𝝭[3] = γ*(2*γ-1)
    𝝭[4] = 4*ξ*η
    𝝭[5] = 4*η*γ
    𝝭[6] = 4*γ*ξ
    ∂𝝭∂x = x[:∂𝝭∂x]
    ∂𝝭∂y = x[:∂𝝭∂y]
    ∂𝝭∂x[1] = (4.0*ξ-1.0)*J₁₁
    ∂𝝭∂x[2] = (4.0*η-1.0)*J₂₁
    ∂𝝭∂x[3] = (4.0*γ-1.0)*J₃₁
    ∂𝝭∂x[4] = 4.0*(η*J₁₁+ξ*J₂₁)
    ∂𝝭∂x[5] = 4.0*(γ*J₂₁+η*J₃₁)
    ∂𝝭∂x[6] = 4.0*(ξ*J₃₁+γ*J₁₁)
    ∂𝝭∂y[1] = (4.0*ξ-1.0)*J₁₂
    ∂𝝭∂y[2] = (4.0*η-1.0)*J₂₂
    ∂𝝭∂y[3] = (4.0*γ-1.0)*J₃₂
    ∂𝝭∂y[4] = 4.0*(η*J₁₂+ξ*J₂₂)
    ∂𝝭∂y[5] = 4.0*(γ*J₂₂+η*J₃₂)
    ∂𝝭∂y[6] = 4.0*(ξ*J₃₂+γ*J₁₂)
    ∂²𝝭∂x² = x[:∂²𝝭∂x² ]
    ∂²𝝭∂x∂y = x[:∂²𝝭∂x∂y ]
    ∂²𝝭∂y² = x[:∂²𝝭∂y² ]
    ∂²𝝭∂x²[1] = 4*J₁₁²
    ∂²𝝭∂x²[2] = 4*J₂₁²
    ∂²𝝭∂x²[3] = 4*J₃₁²
    ∂²𝝭∂x²[4] = 8*J₁₁*J₂₁
    ∂²𝝭∂x²[5] = 8*J₂₁*J₃₁
    ∂²𝝭∂x²[6] = 8*J₃₁*J₁₁
    ∂²𝝭∂x∂y[1] = 4*J₁₁*J₁₂
    ∂²𝝭∂x∂y[2] = 4*J₂₁*J₂₂
    ∂²𝝭∂x∂y[3] = 4*J₃₁*J₃₂
    ∂²𝝭∂x∂y[4] = 4*J₁₁*J₂₂ + 4*J₂₁*J₁₂
    ∂²𝝭∂x∂y[5] = 4*J₂₁*J₃₂ + 4*J₃₁*J₂₂
    ∂²𝝭∂x∂y[6] = 4*J₃₁*J₁₂ + 4*J₁₁*J₃₂
    ∂²𝝭∂y²[1] = 4*J₁₂²
    ∂²𝝭∂y²[2] = 4*J₂₂²
    ∂²𝝭∂y²[3] = 4*J₃₂²
    ∂²𝝭∂y²[4] = 8*J₁₂*J₂₂
    ∂²𝝭∂y²[5] = 8*J₂₂*J₃₂
    ∂²𝝭∂y²[6] = 8*J₃₂*J₁₂
end
